<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>coreSNTP: core_sntp_serializer.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">coreSNTP<span id="projectnumber">&#160;v1.1.0</span>
   </div>
   <div id="projectbrief">Client library for synchronizing device time with internet time using Simple Network Time Protocol (SNTP)</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('core__sntp__serializer_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">core_sntp_serializer.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>API for serializing SNTP request packets and, and de-serializing SNTP response packets. This API layer adheres to the SNTPv4 specification defined in <a href="https://tools.ietf.org/html/rfc4330">RFC 4330</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
</div>
<p><a href="core__sntp__serializer_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure representing an SNTP timestamp.  <a href="struct_sntp_timestamp__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_sntp_response_data__t.html">SntpResponseData_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure representing data parsed from an SNTP response from server as well as data of arithmetic calculations derived from the response.  <a href="struct_sntp_response_data__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga9fb0febdb6e2f2dff2e133ef49ce205b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b">SNTP_PACKET_BASE_SIZE</a>&#160;&#160;&#160;( 48U )</td></tr>
<tr class="memdesc:ga9fb0febdb6e2f2dff2e133ef49ce205b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The base packet size of request and response of the (S)NTP protocol.  <a href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b">More...</a><br /></td></tr>
<tr class="separator:ga9fb0febdb6e2f2dff2e133ef49ce205b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1baca7c2b918d398acbc5f9412c01ebd"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">SNTP_FRACTION_VALUE_PER_MICROSECOND</a>&#160;&#160;&#160;( 4295U )</td></tr>
<tr class="memdesc:ga1baca7c2b918d398acbc5f9412c01ebd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of SNTP timestamp fractions in 1 microsecond.  <a href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">More...</a><br /></td></tr>
<tr class="separator:ga1baca7c2b918d398acbc5f9412c01ebd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae20ed1490028cf58b01e69af5f2aa635"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__constants.html#gae20ed1490028cf58b01e69af5f2aa635">SNTP_TIME_AT_UNIX_EPOCH_SECS</a>&#160;&#160;&#160;( 2208988800U )</td></tr>
<tr class="memdesc:gae20ed1490028cf58b01e69af5f2aa635"><td class="mdescLeft">&#160;</td><td class="mdescRight">The seconds part of SNTP time at the UNIX epoch time, which represents an offset of 70 years (in seconds) between SNTP epoch and UNIX epoch time. SNTP uses 1st Jan 1900 UTC as the epoch time, whereas UNIX standard uses 1st Jan 1970 UTC as the epoch time, thereby, causing an offset of 70 years between them.  <a href="group__sntp__constants.html#gae20ed1490028cf58b01e69af5f2aa635">More...</a><br /></td></tr>
<tr class="separator:gae20ed1490028cf58b01e69af5f2aa635"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabdd46fac2ea38bdacd176c5eb6c8b000"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__constants.html#gabdd46fac2ea38bdacd176c5eb6c8b000">SNTP_TIME_AT_LARGEST_UNIX_TIME_SECS</a>&#160;&#160;&#160;( 61505151U )</td></tr>
<tr class="memdesc:gabdd46fac2ea38bdacd176c5eb6c8b000"><td class="mdescLeft">&#160;</td><td class="mdescRight">The seconds value of SNTP timestamp for the largest UNIX time when using signed 32-bit integer for seconds. The largest time representable with a 32-bit signed integer in UNIX time is 19 Jan 2038 3h 14m 7s UTC. However, as the SNTP time overflows at 7 Feb 2036 6h 28m 16s UTC, therefore, the SNTP time for the largest UNIX time represents the time duration between the 2 timestamps.  <a href="group__sntp__constants.html#gabdd46fac2ea38bdacd176c5eb6c8b000">More...</a><br /></td></tr>
<tr class="separator:gabdd46fac2ea38bdacd176c5eb6c8b000"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0da33f16640e34e0050d90ba50dade65"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__constants.html#ga0da33f16640e34e0050d90ba50dade65">UNIX_TIME_SECS_AT_SNTP_ERA_1_SMALLEST_TIME</a>&#160;&#160;&#160;( 2085978496U )</td></tr>
<tr class="memdesc:ga0da33f16640e34e0050d90ba50dade65"><td class="mdescLeft">&#160;</td><td class="mdescRight">The UNIX time (in seconds) at the smallest SNTP time in era 1, i.e. UNIX time at 7 Feb 2036 6:28:16 UTC/.  <a href="group__sntp__constants.html#ga0da33f16640e34e0050d90ba50dade65">More...</a><br /></td></tr>
<tr class="separator:ga0da33f16640e34e0050d90ba50dade65"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4aa0a62f06b36e48b47e609a6cd0f3ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__constants.html#ga4aa0a62f06b36e48b47e609a6cd0f3ca">SNTP_KISS_OF_DEATH_CODE_LENGTH</a>&#160;&#160;&#160;( 4U )</td></tr>
<tr class="memdesc:ga4aa0a62f06b36e48b47e609a6cd0f3ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">The fixed-length of any Kiss-o'-Death message ASCII code sent in an SNTP server response.  <a href="group__sntp__constants.html#ga4aa0a62f06b36e48b47e609a6cd0f3ca">More...</a><br /></td></tr>
<tr class="separator:ga4aa0a62f06b36e48b47e609a6cd0f3ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2f15147fd62ad044b87f8da1cd3f9f7a"><td class="memItemLeft" align="right" valign="top">
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SNTP_KISS_OF_DEATH_CODE_NONE</b>&#160;&#160;&#160;( 0U )</td></tr>
<tr class="memdesc:ga2f15147fd62ad044b87f8da1cd3f9f7a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The value for the <a class="el" href="struct_sntp_response_data__t.html#a6ce5c37cac67aea775f9578fa4d95e1a" title="If a server responded with Kiss-o&#39;-Death message to reject time request, this is the fixed length ASC...">SntpResponseData_t.rejectedResponseCode</a> member when that the server response packet does not contain a Kiss-o'-Death message, and therefore, does not have a "kiss code". The server sends a "kiss-code" only when it rejects an SNTP request with a Kiss-o'-Death message. <br /></td></tr>
<tr class="separator:ga2f15147fd62ad044b87f8da1cd3f9f7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gaef7b22d8008bbfbbc7bbea5a7a30e798"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> { <br />
&#160;&#160;<a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7">SntpErrorBadParameter</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798ac03ea3068c8293cf7eea8468d8c12324">SntpRejectedResponse</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a771181dbb6df4fb8c21fcb5a160f5ba4">SntpRejectedResponseChangeServer</a>
, <br />
&#160;&#160;<a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a7c75142ae7cd69ed56d05212ec59a267">SntpRejectedResponseRetryWithBackoff</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798adcd6c832a7a1c2d4e656538b5e6fefe9">SntpRejectedResponseOtherCode</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a23891833ba2ad8634832cbbb9d47bd9c">SntpErrorBufferTooSmall</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a4a4f61809052a98c2877cf5035ccc62c">SntpInvalidResponse</a>
, <br />
&#160;&#160;<a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a2b694f63eaa4d94d08e1bbc80f6fd992">SntpZeroPollInterval</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798afba7203b8ee0322999adf1edcca6e0cf">SntpErrorTimeNotSupported</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a71c91750cf5069fc4223e4aaf0a5d4f0">SntpErrorDnsFailure</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6dd0fee9073c6d7c55be89f1bc58b843">SntpErrorNetworkFailure</a>
, <br />
&#160;&#160;<a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798acbefde33f8de7f9fac2c31d6a6008397">SntpServerNotAuthenticated</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6db2603ebf3153c9472d3867694aa787">SntpErrorAuthFailure</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a0e41141d4e0b0f1bf945830f7f2c6be9">SntpErrorSendTimeout</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a379667af0482f651b5630fcc149d9952">SntpErrorResponseTimeout</a>
, <br />
&#160;&#160;<a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a473ea25a626b0ab1067a9887e49d113e">SntpNoResponseReceived</a>
, <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798afc6ed7e8936aa676762523ba8a308e24">SntpErrorContextNotInitialized</a>
<br />
 }</td></tr>
<tr class="memdesc:gaef7b22d8008bbfbbc7bbea5a7a30e798"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumeration of status codes that can be returned by the coreSNTP Library API.  <a href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">More...</a><br /></td></tr>
<tr class="separator:gaef7b22d8008bbfbbc7bbea5a7a30e798"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga69e2cb17ab4e253491602ccfe48b141f"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sntp__enum__types.html#ga69e2cb17ab4e253491602ccfe48b141f">SntpLeapSecondInfo_t</a> { <b>NoLeapSecond</b> = 0x00
, <a class="el" href="group__sntp__enum__types.html#gga69e2cb17ab4e253491602ccfe48b141fa78ff5bb8a6ba0fdafe4fa9aaf001ccbf">LastMinuteHas61Seconds</a> = 0x01
, <a class="el" href="group__sntp__enum__types.html#gga69e2cb17ab4e253491602ccfe48b141fa207adf1efe110b46607b7520fc05e1a8">LastMinuteHas59Seconds</a> = 0x02
, <a class="el" href="group__sntp__enum__types.html#gga69e2cb17ab4e253491602ccfe48b141fae2f7a16e8450c21718a098660423f6a9">AlarmServerNotSynchronized</a> = 0x03
 }</td></tr>
<tr class="memdesc:ga69e2cb17ab4e253491602ccfe48b141f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumeration for leap second information that an SNTP server can send its response to a time request. An SNTP server sends information about whether there is an upcoming leap second adjustment in the last day of the current month.  <a href="group__sntp__enum__types.html#ga69e2cb17ab4e253491602ccfe48b141f">More...</a><br /></td></tr>
<tr class="separator:ga69e2cb17ab4e253491602ccfe48b141f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae3aba893e20b6129984062d1b7bf2fa3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__serializer_8h.html#ae3aba893e20b6129984062d1b7bf2fa3">Sntp_SerializeRequest</a> (<a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pRequestTime, uint32_t randomNumber, void *pBuffer, size_t bufferSize)</td></tr>
<tr class="memdesc:ae3aba893e20b6129984062d1b7bf2fa3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serializes an SNTP request packet to use for querying a time server.  <a href="core__sntp__serializer_8h.html#ae3aba893e20b6129984062d1b7bf2fa3">More...</a><br /></td></tr>
<tr class="separator:ae3aba893e20b6129984062d1b7bf2fa3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f5dbc349d294809a940ef891cba78fa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__serializer_8h.html#a3f5dbc349d294809a940ef891cba78fa">Sntp_DeserializeResponse</a> (const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pRequestTime, const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pResponseRxTime, const void *pResponseBuffer, size_t bufferSize, <a class="el" href="struct_sntp_response_data__t.html">SntpResponseData_t</a> *pParsedResponse)</td></tr>
<tr class="memdesc:a3f5dbc349d294809a940ef891cba78fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">De-serializes an SNTP packet received from a server as a response to a SNTP request.  <a href="core__sntp__serializer_8h.html#a3f5dbc349d294809a940ef891cba78fa">More...</a><br /></td></tr>
<tr class="separator:a3f5dbc349d294809a940ef891cba78fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48dc19a11eb31d6077a2ca8964a1c6a9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__serializer_8h.html#a48dc19a11eb31d6077a2ca8964a1c6a9">Sntp_CalculatePollInterval</a> (uint16_t clockFreqTolerance, uint16_t desiredAccuracy, uint32_t *pPollInterval)</td></tr>
<tr class="memdesc:a48dc19a11eb31d6077a2ca8964a1c6a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility to calculate the poll interval of sending periodic time queries to servers to achieve a desired system clock accuracy for a given frequency tolerance of the system clock.  <a href="core__sntp__serializer_8h.html#a48dc19a11eb31d6077a2ca8964a1c6a9">More...</a><br /></td></tr>
<tr class="separator:a48dc19a11eb31d6077a2ca8964a1c6a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2e96d3bc60bb30db3107a2bc1d69121"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__serializer_8h.html#ae2e96d3bc60bb30db3107a2bc1d69121">Sntp_ConvertToUnixTime</a> (const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pSntpTime, uint32_t *pUnixTimeSecs, uint32_t *pUnixTimeMicrosecs)</td></tr>
<tr class="memdesc:ae2e96d3bc60bb30db3107a2bc1d69121"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility to convert SNTP timestamp (that uses 1st Jan 1900 as the epoch) to UNIX timestamp (that uses 1st Jan 1970 as the epoch).  <a href="core__sntp__serializer_8h.html#ae2e96d3bc60bb30db3107a2bc1d69121">More...</a><br /></td></tr>
<tr class="separator:ae2e96d3bc60bb30db3107a2bc1d69121"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >API for serializing SNTP request packets and, and de-serializing SNTP response packets. This API layer adheres to the SNTPv4 specification defined in <a href="https://tools.ietf.org/html/rfc4330">RFC 4330</a>. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ae3aba893e20b6129984062d1b7bf2fa3" name="ae3aba893e20b6129984062d1b7bf2fa3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3aba893e20b6129984062d1b7bf2fa3">&#9670;&nbsp;</a></span>Sntp_SerializeRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> Sntp_SerializeRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pRequestTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>randomNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bufferSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serializes an SNTP request packet to use for querying a time server. </p>
<p >This function will fill only <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b" title="The base packet size of request and response of the (S)NTP protocol.">SNTP_PACKET_BASE_SIZE</a> bytes of data in the passed buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">pRequestTime</td><td>The current time of the system, expressed as time since the SNTP epoch (i.e. 0h of 1st Jan 1900 ). This time will be serialized in the SNTP request packet. The function will use this parameter to return the timestamp serialized in the SNTP request. To protect against attacks spoofing server responses, the timestamp MUST NOT be zero in value. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">randomNumber</td><td>A random number (generated by a True Random Generator) for use in the SNTP request packet to protect against replay attacks as suggested by SNTPv4 specification. For more information, refer to <a href="https://tools.ietf.org/html/rfc4330#section-3">RFC 4330 Section 3</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pBuffer</td><td>The buffer that will be populated with the serialized SNTP request packet. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bufferSize</td><td>The size of the <code>pBuffer</code> buffer. It should be at least <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b" title="The base packet size of request and response of the (S)NTP protocol.">SNTP_PACKET_BASE_SIZE</a> bytes in size.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>It is recommended to use a True Random Generator (TRNG) to generate the random number. </dd>
<dd>
The application MUST save the <code>pRequestTime</code> value for de-serializing the server response with <a class="el" href="core__sntp__serializer_8h.html#a3f5dbc349d294809a940ef891cba78fa">Sntp_DeserializeResponse</a> API.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>This function returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> when serialization operation is successful.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> if an invalid parameter is passed.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a23891833ba2ad8634832cbbb9d47bd9c" title="Application provided insufficient buffer space for serializing or de-serializing an SNTP packet....">SntpErrorBufferTooSmall</a> if the buffer does not have the minimum size for serializing an SNTP request packet. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a3f5dbc349d294809a940ef891cba78fa" name="a3f5dbc349d294809a940ef891cba78fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f5dbc349d294809a940ef891cba78fa">&#9670;&nbsp;</a></span>Sntp_DeserializeResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> Sntp_DeserializeResponse </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pRequestTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pResponseRxTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>pResponseBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bufferSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_sntp_response_data__t.html">SntpResponseData_t</a> *&#160;</td>
          <td class="paramname"><em>pParsedResponse</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>De-serializes an SNTP packet received from a server as a response to a SNTP request. </p>
<p >This function will parse only the <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b" title="The base packet size of request and response of the (S)NTP protocol.">SNTP_PACKET_BASE_SIZE</a> bytes of data in the passed buffer.</p>
<dl class="section note"><dt>Note</dt><dd>If the server has sent a Kiss-o'-Death message to reject the associated time request, the API function will return the appropriate return code and, also, provide the ASCII code (of fixed length, <a class="el" href="group__sntp__constants.html#ga4aa0a62f06b36e48b47e609a6cd0f3ca" title="The fixed-length of any Kiss-o&#39;-Death message ASCII code sent in an SNTP server response.">SNTP_KISS_OF_DEATH_CODE_LENGTH</a> bytes) in the <a class="el" href="struct_sntp_response_data__t.html#a6ce5c37cac67aea775f9578fa4d95e1a" title="If a server responded with Kiss-o&#39;-Death message to reject time request, this is the fixed length ASC...">SntpResponseData_t.rejectedResponseCode</a> member of <code>pParsedResponse</code> parameter, parsed from the response packet. The application SHOULD respect the server rejection and take appropriate action based on the rejection code. If the server response represents an accepted SNTP client request, then the API function will set the <a class="el" href="struct_sntp_response_data__t.html#a6ce5c37cac67aea775f9578fa4d95e1a" title="If a server responded with Kiss-o&#39;-Death message to reject time request, this is the fixed length ASC...">SntpResponseData_t.rejectedResponseCode</a> member of <code>pParsedResponse</code> parameter to <a class="el" href="group__sntp__constants.html#ga2f15147fd62ad044b87f8da1cd3f9f7a" title="The value for the SntpResponseData_t.rejectedResponseCode member when that the server response packet...">SNTP_KISS_OF_DEATH_CODE_NONE</a>.</dd>
<dd>
If the server has positively responded with its clock time, then this API function will calculate the clock-offset. For the clock-offset to be correctly calculated, the system clock MUST be within ~68 years (or 2^31 seconds) of the server time mentioned. This function supports clock-offset calculation when server and client timestamps are in adjacent NTP eras, with one system is in NTP era 0 (i.e. before 7 Feb 2036 6h:28m:14s UTC) and another system in NTP era 1 (on or after 7 Feb 2036 6h:28m:14s UTC).</dd>
<dd>
In the special case when the server and client times are exactly 2^31 seconds apart, the library ASSUMES that the server time is ahead of the client time, and returns the positive clock-offset value of INT32_MAX seconds.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pRequestTime</td><td>The system time used in the SNTP request packet that is associated with the server response. This MUST be the same as the time returned by the <a class="el" href="core__sntp__serializer_8h.html#ae3aba893e20b6129984062d1b7bf2fa3">Sntp_SerializeRequest</a> API. To protect against attacks spoofing server responses, this timestamp MUST NOT be zero in value. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pResponseRxTime</td><td>The time of the system, expressed as time since the SNTP epoch (i.e. 0h of 1st Jan 1900 ), at receiving SNTP response from server. This time will be used to calculate system clock offset relative to server. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pResponseBuffer</td><td>The buffer containing the SNTP response from the server. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bufferSize</td><td>The size of the <code>pResponseBuffer</code> containing the SNTP response. It MUST be at least <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b" title="The base packet size of request and response of the (S)NTP protocol.">SNTP_PACKET_BASE_SIZE</a> bytes long for a valid SNTP response. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pParsedResponse</td><td>The information parsed from the SNTP response packet. If possible to calculate without overflow, it also contains the system clock offset relative to the server time.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if the de-serialization operation is successful.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> if an invalid parameter is passed.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a23891833ba2ad8634832cbbb9d47bd9c" title="Application provided insufficient buffer space for serializing or de-serializing an SNTP packet....">SntpErrorBufferTooSmall</a> if the buffer does not have the minimum size required for a valid SNTP response packet.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a4a4f61809052a98c2877cf5035ccc62c" title="Server response failed validation checks for expected data in SNTP packet.">SntpInvalidResponse</a> if the response fails sanity checks expected in an SNTP response.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a771181dbb6df4fb8c21fcb5a160f5ba4" title="Server sent a Kiss-o&#39;-Death message with non-retryable code (i.e. DENY or RSTR).">SntpRejectedResponseChangeServer</a> if the server rejected with a code indicating that client cannot be retry requests to it.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a7c75142ae7cd69ed56d05212ec59a267" title="Server sent a Kiss-o&#39;-Death message with a RATE code, which means that client should back-off before ...">SntpRejectedResponseRetryWithBackoff</a> if the server rejected with a code indicating that client should back-off before retrying request.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798adcd6c832a7a1c2d4e656538b5e6fefe9" title="Server sent a Kiss-o&#39;-Death message with a code, specific to the server. Application can inspect the ...">SntpRejectedResponseOtherCode</a> if the server rejected with a code that application can inspect in the <code>pParsedResponse</code> parameter. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a48dc19a11eb31d6077a2ca8964a1c6a9" name="a48dc19a11eb31d6077a2ca8964a1c6a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48dc19a11eb31d6077a2ca8964a1c6a9">&#9670;&nbsp;</a></span>Sntp_CalculatePollInterval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> Sntp_CalculatePollInterval </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>clockFreqTolerance</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>desiredAccuracy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>pPollInterval</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Utility to calculate the poll interval of sending periodic time queries to servers to achieve a desired system clock accuracy for a given frequency tolerance of the system clock. </p>
<p >For example, from the SNTPv4 specification, "if the frequency tolerance
is 200 parts per million (PPM) and the required accuracy is one minute,
the maximum timeout is about 3.5 days". In this example, the system clock frequency tolerance is 200 PPM and the desired accuracy is 60000 milliseconds (or 1 minute) for which this API function will return the maximum poll interval value as 2^18 seconds (or ~3 days).</p>
<dl class="section note"><dt>Note</dt><dd>The poll interval returned is a power of 2, which is the standard way to represent the value. According to the SNTPv4 specification Best Practices, an SNTP client SHOULD NOT have a poll interval less than 15 seconds. <a href="https://tools.ietf.org/html/rfc4330#section-10">https://tools.ietf.org/html/rfc4330#section-10</a>. This API function DOES NOT support poll interval calculation less than 1 second.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">clockFreqTolerance</td><td>The frequency tolerance of system clock in parts per million (PPM) units. This parameter MUST be non-zero. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">desiredAccuracy</td><td>The acceptable maximum drift, in milliseconds, for the system clock. The maximum value (0xFFFF) represents ~1 minute of desired clock accuracy. This parameter MUST be non-zero. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pPollInterval</td><td>This is filled with the poll interval, in seconds calculated as the closest power of 2 value that will achieve either the exact desired or higher clock accuracy <code>desiredAccuracy</code>, for the given clock frequency tolerance, <code>clockFreqTolerance</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if calculation is successful.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> for an invalid parameter passed to the function.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a2b694f63eaa4d94d08e1bbc80f6fd992" title="Poll interval value is under 1 second which cannot be calculated by Sntp_CalculatePollInterval.">SntpZeroPollInterval</a> if calculated poll interval is less than 1 second. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="ae2e96d3bc60bb30db3107a2bc1d69121" name="ae2e96d3bc60bb30db3107a2bc1d69121"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2e96d3bc60bb30db3107a2bc1d69121">&#9670;&nbsp;</a></span>Sntp_ConvertToUnixTime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> Sntp_ConvertToUnixTime </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pSntpTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>pUnixTimeSecs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>pUnixTimeMicrosecs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Utility to convert SNTP timestamp (that uses 1st Jan 1900 as the epoch) to UNIX timestamp (that uses 1st Jan 1970 as the epoch). </p>
<dl class="section note"><dt>Note</dt><dd>This function can ONLY handle conversions of SNTP timestamps that lie in the range from 1st Jan 1970 0h 0m 0s, the UNIX epoch time, to 19th Jan 2038 3h 14m 7s, the maximum UNIX time that can be represented in a signed 32 bit integer. (The limitation is to support systems that use signed 32-bit integer to represent the seconds part of the UNIX time.)</dd>
<dd>
This function supports overflow of the SNTP timestamp (from the 7 Feb 2036 6h 28m 16s time, i.e. SNTP era 1) by treating the timestamps with seconds part in the range [0, 61,505,152] seconds where the upper limit represents the UNIX overflow time (i.e. 19 Jan 2038 3h 14m 7s) for systems that use signed 32-bit integer to represent time.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pSntpTime</td><td>The SNTP timestamp to convert to UNIX time. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pUnixTimeSecs</td><td>This will be filled with the seconds part of the UNIX time equivalent of the SNTP time, <code>pSntpTime</code>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pUnixTimeMicrosecs</td><td>This will be filled with the microseconds part of the UNIX time equivalent of the SNTP time, <code>pSntpTime</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if conversion to UNIX time is successful</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> if any of the passed parameters are NULL.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798afba7203b8ee0322999adf1edcca6e0cf" title="SNTP timestamp cannot be converted to UNIX time as time does not lie in time range supported by Sntp_...">SntpErrorTimeNotSupported</a> if the passed SNTP time does not lie in the supported time range. </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="dir_8ee1a5e78eaec319fe5d64075812fc61.html">include</a></li><li class="navelem"><a class="el" href="core__sntp__serializer_8h.html">core_sntp_serializer.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>

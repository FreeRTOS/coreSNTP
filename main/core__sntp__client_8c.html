<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>coreSNTP: core_sntp_client.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">coreSNTP<span id="projectnumber">&#160;v1.1.1</span>
   </div>
   <div id="projectbrief">Client library for synchronizing device time with internet time using Simple Network Time Protocol (SNTP)</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('core__sntp__client_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">core_sntp_client.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of the client API of the coreSNTP library.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="core__sntp__client_8h_source.html">core_sntp_client.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="core__sntp__config__defaults_8h_source.html">core_sntp_config_defaults.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a9f79d93e8044b89d139c1b0ca92c4058"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a9f79d93e8044b89d139c1b0ca92c4058">FRACTIONS_TO_MS</a>(fractions)&#160;&#160;&#160;    ( fractions / ( <a class="el" href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">SNTP_FRACTION_VALUE_PER_MICROSECOND</a> * 1000U ) )</td></tr>
<tr class="memdesc:a9f79d93e8044b89d139c1b0ca92c4058"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility to convert fractions part of SNTP timestamp to milliseconds.  <a href="core__sntp__client_8c.html#a9f79d93e8044b89d139c1b0ca92c4058">More...</a><br /></td></tr>
<tr class="separator:a9f79d93e8044b89d139c1b0ca92c4058"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae7f3fa647cd74f09878af88e430707fc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#ae7f3fa647cd74f09878af88e430707fc">Sntp_Init</a> (<a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *pContext, const <a class="el" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> *pTimeServers, size_t numOfServers, uint32_t serverResponseTimeoutMs, uint8_t *pNetworkBuffer, size_t bufferSize, <a class="el" href="group__sntp__callback__types.html#gaef268b4cc2cf00e3e573b637cde7c09e">SntpResolveDns_t</a> resolveDnsFunc, <a class="el" href="group__sntp__callback__types.html#ga1e30d57887e46bee4074a5ba62f681e8">SntpGetTime_t</a> getSystemTimeFunc, <a class="el" href="group__sntp__callback__types.html#gade7b1a15684e1272ef7dbb9e4486c285">SntpSetTime_t</a> setSystemTimeFunc, const <a class="el" href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a> *pTransportIntf, const <a class="el" href="struct_sntp_authentication_interface__t.html">SntpAuthenticationInterface_t</a> *pAuthIntf)</td></tr>
<tr class="memdesc:ae7f3fa647cd74f09878af88e430707fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a context for SNTP client communication with SNTP/NTP servers.  <a href="core__sntp__client_8c.html#ae7f3fa647cd74f09878af88e430707fc">More...</a><br /></td></tr>
<tr class="separator:ae7f3fa647cd74f09878af88e430707fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a539d77b67f608898b1a61e4b51fdda84"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a539d77b67f608898b1a61e4b51fdda84">calculateElapsedTimeMs</a> (const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pCurrentTime, const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pOlderTime)</td></tr>
<tr class="memdesc:a539d77b67f608898b1a61e4b51fdda84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility to calculate the difference in milliseconds between 2 SNTP timestamps.  <a href="core__sntp__client_8c.html#a539d77b67f608898b1a61e4b51fdda84">More...</a><br /></td></tr>
<tr class="separator:a539d77b67f608898b1a61e4b51fdda84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b3bbefb1f49923cf6636e1325b734fb"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a8b3bbefb1f49923cf6636e1325b734fb">validateContext</a> (const <a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *pContext)</td></tr>
<tr class="memdesc:a8b3bbefb1f49923cf6636e1325b734fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Validates the content of the SNTP context passed to the APIs to check whether it represents an initialized context.  <a href="core__sntp__client_8c.html#a8b3bbefb1f49923cf6636e1325b734fb">More...</a><br /></td></tr>
<tr class="separator:a8b3bbefb1f49923cf6636e1325b734fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a800cb2511eaa8dc9c534938b543bc194"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a800cb2511eaa8dc9c534938b543bc194">sendSntpPacket</a> (const <a class="el" href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a> *pNetworkIntf, uint32_t timeServer, uint16_t serverPort, <a class="el" href="group__sntp__callback__types.html#ga1e30d57887e46bee4074a5ba62f681e8">SntpGetTime_t</a> getTimeFunc, const uint8_t *pPacket, uint16_t packetSize, uint32_t timeoutMs)</td></tr>
<tr class="memdesc:a800cb2511eaa8dc9c534938b543bc194"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends SNTP request packet to the passed server over the network using transport interface's send function.  <a href="core__sntp__client_8c.html#a800cb2511eaa8dc9c534938b543bc194">More...</a><br /></td></tr>
<tr class="separator:a800cb2511eaa8dc9c534938b543bc194"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e9b3e3bc43f97ac8f8ad6c5933b1cb4"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a6e9b3e3bc43f97ac8f8ad6c5933b1cb4">addClientAuthentication</a> (<a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *pContext)</td></tr>
<tr class="memdesc:a6e9b3e3bc43f97ac8f8ad6c5933b1cb4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds client authentication data to SNTP request packet by calling the authentication interface.  <a href="core__sntp__client_8c.html#a6e9b3e3bc43f97ac8f8ad6c5933b1cb4">More...</a><br /></td></tr>
<tr class="separator:a6e9b3e3bc43f97ac8f8ad6c5933b1cb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6cb1fe85cff973b2cfa73751adb4062"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a> (<a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *pContext, uint32_t randomNumber, uint32_t blockTimeMs)</td></tr>
<tr class="memdesc:ae6cb1fe85cff973b2cfa73751adb4062"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a request for time from the currently configured server (in the context). If the user has provided an authentication interface, the client authentication code is appended to the request before sending over the network by calling the <a class="el" href="group__sntp__callback__types.html#ga7f01446c0d655614b99fd4043c8f032a">SntpGenerateAuthCode_t</a> function of the <a class="el" href="struct_sntp_authentication_interface__t.html">SntpAuthenticationInterface_t</a>.  <a href="core__sntp__client_8c.html#ae6cb1fe85cff973b2cfa73751adb4062">More...</a><br /></td></tr>
<tr class="separator:ae6cb1fe85cff973b2cfa73751adb4062"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa77f2e8c1c06ad75bfd8066db2103a8d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#aa77f2e8c1c06ad75bfd8066db2103a8d">rotateServerForNextTimeQuery</a> (<a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *pContext)</td></tr>
<tr class="memdesc:aa77f2e8c1c06ad75bfd8066db2103a8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility to update the SNTP context to rotate the server of use for subsequent time request(s).  <a href="core__sntp__client_8c.html#aa77f2e8c1c06ad75bfd8066db2103a8d">More...</a><br /></td></tr>
<tr class="separator:aa77f2e8c1c06ad75bfd8066db2103a8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad508626c97a253524a1f858ee456496d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#ad508626c97a253524a1f858ee456496d">receiveSntpResponse</a> (const <a class="el" href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a> *pTransportIntf, uint32_t timeServer, uint16_t serverPort, uint8_t *pBuffer, uint16_t responseSize)</td></tr>
<tr class="memdesc:ad508626c97a253524a1f858ee456496d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function attempts to receive the SNTP response packet from a server.  <a href="core__sntp__client_8c.html#ad508626c97a253524a1f858ee456496d">More...</a><br /></td></tr>
<tr class="separator:ad508626c97a253524a1f858ee456496d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bcabc940720dd18a24fd0f45c18fecd"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a4bcabc940720dd18a24fd0f45c18fecd">processServerResponse</a> (<a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *pContext, const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pResponseRxTime)</td></tr>
<tr class="memdesc:a4bcabc940720dd18a24fd0f45c18fecd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes the response from a server by de-serializing the SNTP packet to validate the server (if an authentication interface has been configured), determine whether server has accepted or rejected the time request, and update the system clock if the server responded positively with time.  <a href="core__sntp__client_8c.html#a4bcabc940720dd18a24fd0f45c18fecd">More...</a><br /></td></tr>
<tr class="separator:a4bcabc940720dd18a24fd0f45c18fecd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36f41da3f2c0849a8b5753e091d1f307"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a36f41da3f2c0849a8b5753e091d1f307">decideAboutReadRetry</a> (const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pCurrentTime, const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pReadStartTime, const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *pRequestTime, uint32_t responseTimeoutMs, uint32_t blockTimeMs, bool *pHasResponseTimedOut)</td></tr>
<tr class="memdesc:a36f41da3f2c0849a8b5753e091d1f307"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines whether a retry attempt should be made to receive server response packet from the network depending on the timing constraints of server response timeout, <code>responseTimeoutMs</code>, and the block time period, <code>blockTimeMs</code>, passed. If neither of the time windows have expired, the function determines that the read operation can be re-tried.  <a href="core__sntp__client_8c.html#a36f41da3f2c0849a8b5753e091d1f307">More...</a><br /></td></tr>
<tr class="separator:a36f41da3f2c0849a8b5753e091d1f307"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab077d90d19e70a33ab08b31f48728ba5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#ab077d90d19e70a33ab08b31f48728ba5">Sntp_ReceiveTimeResponse</a> (<a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *pContext, uint32_t blockTimeMs)</td></tr>
<tr class="memdesc:ab077d90d19e70a33ab08b31f48728ba5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receives a time response from the server that has been requested for time with the <a class="el" href="core__sntp__client_8h.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a> API function. Once an accepted response containing time from server is received, this function calls the user-defined <a class="el" href="group__sntp__callback__types.html#gade7b1a15684e1272ef7dbb9e4486c285">SntpSetTime_t</a> function to update the system time.  <a href="core__sntp__client_8c.html#ab077d90d19e70a33ab08b31f48728ba5">More...</a><br /></td></tr>
<tr class="separator:ab077d90d19e70a33ab08b31f48728ba5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a636a84baa528354ea6115e6af2c46eed"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core__sntp__client_8c.html#a636a84baa528354ea6115e6af2c46eed">Sntp_StatusToStr</a> (<a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> status)</td></tr>
<tr class="memdesc:a636a84baa528354ea6115e6af2c46eed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> to its equivalent string.  <a href="core__sntp__client_8c.html#a636a84baa528354ea6115e6af2c46eed">More...</a><br /></td></tr>
<tr class="separator:a636a84baa528354ea6115e6af2c46eed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Implementation of the client API of the coreSNTP library. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a9f79d93e8044b89d139c1b0ca92c4058" name="a9f79d93e8044b89d139c1b0ca92c4058"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f79d93e8044b89d139c1b0ca92c4058">&#9670;&nbsp;</a></span>FRACTIONS_TO_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FRACTIONS_TO_MS</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fractions</td><td>)</td>
          <td>&#160;&#160;&#160;    ( fractions / ( <a class="el" href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">SNTP_FRACTION_VALUE_PER_MICROSECOND</a> * 1000U ) )</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Utility to convert fractions part of SNTP timestamp to milliseconds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fractions</td><td>The fractions value in an SNTP timestamp. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ae7f3fa647cd74f09878af88e430707fc" name="ae7f3fa647cd74f09878af88e430707fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7f3fa647cd74f09878af88e430707fc">&#9670;&nbsp;</a></span>Sntp_Init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> Sntp_Init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *&#160;</td>
          <td class="paramname"><em>pContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> *&#160;</td>
          <td class="paramname"><em>pTimeServers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>numOfServers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>serverResponseTimeoutMs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pNetworkBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bufferSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__sntp__callback__types.html#gaef268b4cc2cf00e3e573b637cde7c09e">SntpResolveDns_t</a>&#160;</td>
          <td class="paramname"><em>resolveDnsFunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__sntp__callback__types.html#ga1e30d57887e46bee4074a5ba62f681e8">SntpGetTime_t</a>&#160;</td>
          <td class="paramname"><em>getSystemTimeFunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__sntp__callback__types.html#gade7b1a15684e1272ef7dbb9e4486c285">SntpSetTime_t</a>&#160;</td>
          <td class="paramname"><em>setSystemTimeFunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a> *&#160;</td>
          <td class="paramname"><em>pTransportIntf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_sntp_authentication_interface__t.html">SntpAuthenticationInterface_t</a> *&#160;</td>
          <td class="paramname"><em>pAuthIntf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes a context for SNTP client communication with SNTP/NTP servers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">pContext</td><td>The user-supplied memory for the context that will be initialized to represent an SNTP client. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pTimeServers</td><td>The list of decreasing order of priority of time servers that should be used by the SNTP client. This list MUST stay in scope for all the time of use of the context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numOfServers</td><td>The number of servers in the list, <code>pTimeServers</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">serverResponseTimeoutMs</td><td>The timeout duration (in milliseconds) for receiving server response for time requests. The same timeout value is used for each server in the <code>pTimeServers</code> list. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pNetworkBuffer</td><td>The user-supplied memory that will be used for storing network data for SNTP client-server communication. The buffer MUST stay in scope for all the time of use of the context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bufferSize</td><td>The size of the passed buffer <code>pNetworkBuffer</code>. The buffer SHOULD be appropriately sized for storing an entire SNTP packet which includes both <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b" title="The base packet size of request and response of the (S)NTP protocol.">SNTP_PACKET_BASE_SIZE</a> bytes of standard SNTP packet size, and space for authentication data, if security mechanism is used to communicate with any of the time servers configured for use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">resolveDnsFunc</td><td>The user-defined function for DNS resolution of time server. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">getSystemTimeFunc</td><td>The user-defined function for querying system time. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">setSystemTimeFunc</td><td>The user-defined function for correcting system time for every successful time response received from a server. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pTransportIntf</td><td>The user-defined function for performing network send/recv operations over UDP. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pAuthIntf</td><td>The user-defined interface for generating client authentication in SNTP requests and authenticating servers in SNTP responses, if security mechanism is used in SNTP communication with server(s). If security mechanism is not used in communication with any of the configured servers (in <code>pTimeServers</code>), then the <a class="el" href="struct_sntp_authentication_interface__t.html">SntpAuthenticationInterface_t</a> does not need to be defined and this parameter can be NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if the context is initialized.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> if any of the passed parameters in invalid.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a23891833ba2ad8634832cbbb9d47bd9c" title="Application provided insufficient buffer space for serializing or de-serializing an SNTP packet....">SntpErrorBufferTooSmall</a> if the buffer does not have the minimum size required for a valid SNTP response packet. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a539d77b67f608898b1a61e4b51fdda84" name="a539d77b67f608898b1a61e4b51fdda84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a539d77b67f608898b1a61e4b51fdda84">&#9670;&nbsp;</a></span>calculateElapsedTimeMs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t calculateElapsedTimeMs </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pCurrentTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pOlderTime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Utility to calculate the difference in milliseconds between 2 SNTP timestamps. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pCurrentTime</td><td>The more recent timestamp. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pOlderTime</td><td>The older timestamp.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This functions supports the edge case of SNTP timestamp overflow when <code>pCurrentTime</code> represents time in NTP era 1 (i.e. time since 7 Feb 2036) and the <code>OlderTime</code> represents time in NTP era 0 (i.e. time since 1st Jan 1900).</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the calculated time duration between the two timestamps.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function returns the calculated time difference as unsigned 64 bit to avoid integer overflow when converting time difference between the seconds part of the timestamps, which are 32 bits wide, to milliseconds. </dd></dl>

</div>
</div>
<a id="a8b3bbefb1f49923cf6636e1325b734fb" name="a8b3bbefb1f49923cf6636e1325b734fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b3bbefb1f49923cf6636e1325b734fb">&#9670;&nbsp;</a></span>validateContext()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> validateContext </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *&#160;</td>
          <td class="paramname"><em>pContext</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Validates the content of the SNTP context passed to the APIs to check whether it represents an initialized context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pContext</td><td>The SNTP context to validate.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if the context is verified to be initialized.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> if the context is NULL.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798afc6ed7e8936aa676762523ba8a308e24" title="The SNTP context passed to Sntp_SendTimeRequest or Sntp_ReceiveTimeResponse APIs is is uninitialized.">SntpErrorContextNotInitialized</a> if the context is validated to be initialized. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a800cb2511eaa8dc9c534938b543bc194" name="a800cb2511eaa8dc9c534938b543bc194"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a800cb2511eaa8dc9c534938b543bc194">&#9670;&nbsp;</a></span>sendSntpPacket()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> sendSntpPacket </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a> *&#160;</td>
          <td class="paramname"><em>pNetworkIntf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeServer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>serverPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__sntp__callback__types.html#ga1e30d57887e46bee4074a5ba62f681e8">SntpGetTime_t</a>&#160;</td>
          <td class="paramname"><em>getTimeFunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>pPacket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>packetSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeoutMs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends SNTP request packet to the passed server over the network using transport interface's send function. </p>
<dl class="section note"><dt>Note</dt><dd>For the case of zero byte transmissions over the network, this function repeatedly retries the send operation by calling the transport interface until either:<ol type="1">
<li>The requested number of bytes <code>packetSize</code> have been sent. OR</li>
<li>There is an error in sending data over the network.</li>
</ol>
</dd>
<dd>
This function treats partial data transmissions as error as UDP transport protocol does not support partial sends.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pNetworkIntf</td><td>The UDP transport interface to use for sending data over the network. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeServer</td><td>The IPv4 address of the server to send the SNTP request packet to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">serverPort</td><td>The port of the <code>timeServer</code> to send the request to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">getTimeFunc</td><td>The function to query system time for tracking retry time period of no data transmissions. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pPacket</td><td>The buffer containing the SNTP packet data to send over the network. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">packetSize</td><td>The size of data in the SNTP request packet. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeoutMs</td><td>The timeout period for retry attempts of sending SNTP request packet over the network.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> on successful transmission of the entire SNTP request packet over the network; <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6dd0fee9073c6d7c55be89f1bc58b843" title="Networking operation of sending or receiving SNTP packet through the user-defined UDP transport inter...">SntpErrorNetworkFailure</a> to indicate failure from transport interface; <a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a0e41141d4e0b0f1bf945830f7f2c6be9" title="A timeout occurred in sending time request packet over the network to a server through the Sntp_SendT...">SntpErrorSendTimeout</a> if time request could not be sent over the network within the <code>timeoutMs</code> duration. </dd></dl>

</div>
</div>
<a id="a6e9b3e3bc43f97ac8f8ad6c5933b1cb4" name="a6e9b3e3bc43f97ac8f8ad6c5933b1cb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e9b3e3bc43f97ac8f8ad6c5933b1cb4">&#9670;&nbsp;</a></span>addClientAuthentication()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> addClientAuthentication </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *&#160;</td>
          <td class="paramname"><em>pContext</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Adds client authentication data to SNTP request packet by calling the authentication interface. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pContext</td><td>The SNTP context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if the interface function successfully appends client authentication data.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6db2603ebf3153c9472d3867694aa787" title="Failure from the user-supplied authentication interface, SntpAuthenticationInterface_t,...">SntpErrorAuthFailure</a> when the interface returns either an error OR an incorrect size of the client authentication data. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="ae6cb1fe85cff973b2cfa73751adb4062" name="ae6cb1fe85cff973b2cfa73751adb4062"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6cb1fe85cff973b2cfa73751adb4062">&#9670;&nbsp;</a></span>Sntp_SendTimeRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> Sntp_SendTimeRequest </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *&#160;</td>
          <td class="paramname"><em>pContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>randomNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>blockTimeMs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a request for time from the currently configured server (in the context). If the user has provided an authentication interface, the client authentication code is appended to the request before sending over the network by calling the <a class="el" href="group__sntp__callback__types.html#ga7f01446c0d655614b99fd4043c8f032a">SntpGenerateAuthCode_t</a> function of the <a class="el" href="struct_sntp_authentication_interface__t.html">SntpAuthenticationInterface_t</a>. </p>
<dl class="section note"><dt>Note</dt><dd>This function will ONLY send a request if there is a server available in the configured list that has not rejected an earlier request for time. This adheres to the Best Practice functionality specified in <a href="https://tools.ietf.org/html/rfc4330#section-10">Section 10 Point 8 of SNTPv4 specification</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pContext</td><td>The context representing an SNTPv4 client. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">randomNumber</td><td>A random number serializing the SNTP request packet to protect against spoofing attacks by attackers that are off the network path of the SNTP client-server communication. This mechanism is suggested by SNTPv4 specification in <a href="https://tools.ietf.org/html/rfc4330#section-3">RFC 4330 Section 3</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blockTimeMs</td><td>The maximum duration of time (in milliseconds) the function will block on attempting to send time request to the server over the network. If a zero block time value is provided, then the function will attempt to send the packet ONLY once.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>It is RECOMMENDED that a True Random Number Generator is used to generate the random number by using a hardware module, like Hardware Security Module (HSM), Secure Element, etc, as the entropy source.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>The API function returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if a time request is successfully sent to the currently configured time server in the context.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> if an invalid context is passed to the function.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798afc6ed7e8936aa676762523ba8a308e24" title="The SNTP context passed to Sntp_SendTimeRequest or Sntp_ReceiveTimeResponse APIs is is uninitialized.">SntpErrorContextNotInitialized</a> if an uninitialized or invalid context is passed to the function.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a71c91750cf5069fc4223e4aaf0a5d4f0" title="The user-defined DNS resolution interface, SntpResolveDns_t, failed to resolve address for a time ser...">SntpErrorDnsFailure</a> if there is failure in the user-defined function for DNS resolution of the time server.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6dd0fee9073c6d7c55be89f1bc58b843" title="Networking operation of sending or receiving SNTP packet through the user-defined UDP transport inter...">SntpErrorNetworkFailure</a> if the SNTP request could not be sent over the network through the user-defined transport interface.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6db2603ebf3153c9472d3867694aa787" title="Failure from the user-supplied authentication interface, SntpAuthenticationInterface_t,...">SntpErrorAuthFailure</a> if there was a failure in generating the client authentication code in the user-defined authentication interface.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a0e41141d4e0b0f1bf945830f7f2c6be9" title="A timeout occurred in sending time request packet over the network to a server through the Sntp_SendT...">SntpErrorSendTimeout</a> if the time request packet could not be sent over the network for the entire <code>blockTimeMs</code> duration. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="aa77f2e8c1c06ad75bfd8066db2103a8d" name="aa77f2e8c1c06ad75bfd8066db2103a8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa77f2e8c1c06ad75bfd8066db2103a8d">&#9670;&nbsp;</a></span>rotateServerForNextTimeQuery()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void rotateServerForNextTimeQuery </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *&#160;</td>
          <td class="paramname"><em>pContext</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Utility to update the SNTP context to rotate the server of use for subsequent time request(s). </p>
<dl class="section note"><dt>Note</dt><dd>If there is no next server remaining, after the current server's index, in the list of configured servers, the server rotation algorithm wraps around to the first server in the list. The wrap around is done so that an application using the library for a long-running SNTP client functionality (like a daemon task) does not become dysfunctional after all configured time servers have been used up. Time synchronization can be a critical functionality for a system and the wrap around logic ensures that the SNTP client continues to function in such a case.</dd>
<dd>
Server rotation is performed ONLY when either of:<ul>
<li>The current server responds with a rejection for time request. OR</li>
<li>The current server response wait has timed out. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="ad508626c97a253524a1f858ee456496d" name="ad508626c97a253524a1f858ee456496d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad508626c97a253524a1f858ee456496d">&#9670;&nbsp;</a></span>receiveSntpResponse()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> receiveSntpResponse </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a> *&#160;</td>
          <td class="paramname"><em>pTransportIntf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeServer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>serverPort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>responseSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function attempts to receive the SNTP response packet from a server. </p>
<dl class="section note"><dt>Note</dt><dd>This function treats reads of data sizes less than the expected server response packet, as an error as UDP does not support partial reads. Such a scenario can exist either due:<ul>
<li>An error in the server sending its response with smaller packet size than the request packet OR</li>
<li>A malicious attacker spoofing or modifying server response OR</li>
<li>An error in the UDP transport interface implementation for read operation.</li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pTransportIntf</td><td>The UDP transport interface to use for receiving data from the network. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeServer</td><td>The server to read the response from the network. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">serverPort</td><td>The port of the server to read the response from. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">pBuffer</td><td>This will be filled with the server response read from the network. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">responseSize</td><td>The size of server response to read from the network.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>It returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if an SNTP response packet is received from the network.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a473ea25a626b0ab1067a9887e49d113e" title="No SNTP packet for server response is received from the network by the Sntp_ReceiveTimeResponse API.">SntpNoResponseReceived</a> if a server response is not received from the network.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6dd0fee9073c6d7c55be89f1bc58b843" title="Networking operation of sending or receiving SNTP packet through the user-defined UDP transport inter...">SntpErrorNetworkFailure</a> if there is an internal failure in reading from the network in the user-defined transport interface. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a4bcabc940720dd18a24fd0f45c18fecd" name="a4bcabc940720dd18a24fd0f45c18fecd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bcabc940720dd18a24fd0f45c18fecd">&#9670;&nbsp;</a></span>processServerResponse()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> processServerResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *&#160;</td>
          <td class="paramname"><em>pContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pResponseRxTime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Processes the response from a server by de-serializing the SNTP packet to validate the server (if an authentication interface has been configured), determine whether server has accepted or rejected the time request, and update the system clock if the server responded positively with time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pContext</td><td>The SNTP context representing the SNTP client. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pResponseRxTime</td><td>The time of receiving the server response from the network.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>It returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if the server response is successfully de-serialized and system clock updated.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6db2603ebf3153c9472d3867694aa787" title="Failure from the user-supplied authentication interface, SntpAuthenticationInterface_t,...">SntpErrorAuthFailure</a> if there is internal failure in user-defined authentication interface when validating server from the response.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798acbefde33f8de7f9fac2c31d6a6008397" title="Time server is not authenticated from the authentication data in its response. This status can be ret...">SntpServerNotAuthenticated</a> if the server failed authenticated check in the user-defined interface.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798ac03ea3068c8293cf7eea8468d8c12324" title="Server sent a Kiss-o&#39;-Death message to reject the request for time. This status can be returned by th...">SntpRejectedResponse</a> if the server has rejected the time request in its response.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a4a4f61809052a98c2877cf5035ccc62c" title="Server response failed validation checks for expected data in SNTP packet.">SntpInvalidResponse</a> if the server response failed sanity checks. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a36f41da3f2c0849a8b5753e091d1f307" name="a36f41da3f2c0849a8b5753e091d1f307"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36f41da3f2c0849a8b5753e091d1f307">&#9670;&nbsp;</a></span>decideAboutReadRetry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool decideAboutReadRetry </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pCurrentTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pReadStartTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> *&#160;</td>
          <td class="paramname"><em>pRequestTime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>responseTimeoutMs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>blockTimeMs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>pHasResponseTimedOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determines whether a retry attempt should be made to receive server response packet from the network depending on the timing constraints of server response timeout, <code>responseTimeoutMs</code>, and the block time period, <code>blockTimeMs</code>, passed. If neither of the time windows have expired, the function determines that the read operation can be re-tried. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pCurrentTime</td><td>The current time in the system used for calculating elapsed time windows. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pReadStartTime</td><td>The time of the first read attempt in the current set of read tries occurring from the Sntp_ReceiveTimeRequest API call by the application. This time is used for calculating the elapsed time to determine whether the block time has expired. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pRequestTime</td><td>The time of sending the SNTP request to the server for which the response is awaited. This time is used for calculating total elapsed elapsed time of waiting for server response to determine if a server response timeout has occurred. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">responseTimeoutMs</td><td>The server response timeout configuration. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blockTimeMs</td><td>The maximum block time of waiting for server response across read tries in the current call made by application to Sntp_ReceiveTimeResponse API. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">pHasResponseTimedOut</td><td>This will be populated with state to indicate whether the wait for server response has timed out.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns true for retrying read operation of server response; false on either server response timeout OR completion of block time window. </dd></dl>

</div>
</div>
<a id="ab077d90d19e70a33ab08b31f48728ba5" name="ab077d90d19e70a33ab08b31f48728ba5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab077d90d19e70a33ab08b31f48728ba5">&#9670;&nbsp;</a></span>Sntp_ReceiveTimeResponse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> Sntp_ReceiveTimeResponse </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_sntp_context__t.html">SntpContext_t</a> *&#160;</td>
          <td class="paramname"><em>pContext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>blockTimeMs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receives a time response from the server that has been requested for time with the <a class="el" href="core__sntp__client_8h.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a> API function. Once an accepted response containing time from server is received, this function calls the user-defined <a class="el" href="group__sntp__callback__types.html#gade7b1a15684e1272ef7dbb9e4486c285">SntpSetTime_t</a> function to update the system time. </p>
<dl class="section note"><dt>Note</dt><dd>If the user has provided an authentication interface to the client (through <a class="el" href="core__sntp__client_8h.html#ae7f3fa647cd74f09878af88e430707fc">Sntp_Init</a>), the server response is authenticated by calling the <a class="el" href="group__sntp__callback__types.html#gae382a67b0ffbb4721d8d599efe3020c4">SntpValidateServerAuth_t</a> function of the <a class="el" href="struct_sntp_authentication_interface__t.html">SntpAuthenticationInterface_t</a> interface.</dd>
<dd>
On receiving a successful server response containing server time, this API calculates the clock offset value of the system clock relative to the server before calling the user-defined <a class="el" href="group__sntp__callback__types.html#gade7b1a15684e1272ef7dbb9e4486c285">SntpSetTime_t</a> function for updating the system time.</dd>
<dd>
For correct calculation of clock-offset, the server and client times MUST be within ~68 years (or 2^31 seconds) of each other. In the special case when the server and client times are exactly 2^31 seconds apart, the library ASSUMES that the server time is ahead of the client time, and returns the positive clock-offset value of INT32_MAX seconds.</dd>
<dd>
This API will rotate the server of use in the library for the next time request (through the <a class="el" href="core__sntp__client_8h.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a>) if either of following events occur:<ul>
<li>The server has responded with a rejection for the time request. OR</li>
<li>The server response wait has timed out. If all the servers configured in the context have been used, the API will rotate server for time query back to the first server in the list which will be used in next time request.</li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pContext</td><td>The context representing an SNTPv4 client. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blockTimeMs</td><td>The maximum duration of time (in milliseconds) the function will block on receiving a response from the server unless either the response is received OR a response timeout occurs.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function can be called multiple times with zero or small blocking times to poll whether server response is received until either the response response is received from the server OR a response timeout has occurred.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>This API functions returns one of the following:<ul>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016" title="Successful operation of an SNTP API.">SntpSuccess</a> if a successful server response is received.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798afc6ed7e8936aa676762523ba8a308e24" title="The SNTP context passed to Sntp_SendTimeRequest or Sntp_ReceiveTimeResponse APIs is is uninitialized.">SntpErrorContextNotInitialized</a> if an uninitialized or invalid context is passed to the function.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a1829c0158e4f2630b6806afa4511dfd7" title="Invalid parameter passed to an API function.">SntpErrorBadParameter</a> if an invalid context is passed to the function.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6dd0fee9073c6d7c55be89f1bc58b843" title="Networking operation of sending or receiving SNTP packet through the user-defined UDP transport inter...">SntpErrorNetworkFailure</a> if there is a failure in the user-defined transport</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a6db2603ebf3153c9472d3867694aa787" title="Failure from the user-supplied authentication interface, SntpAuthenticationInterface_t,...">SntpErrorAuthFailure</a> if an internal error occurs in the user-defined authentication interface when validating the server response.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798acbefde33f8de7f9fac2c31d6a6008397" title="Time server is not authenticated from the authentication data in its response. This status can be ret...">SntpServerNotAuthenticated</a> when the server could not be authenticated from its response with the user-defined authentication interface.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a4a4f61809052a98c2877cf5035ccc62c" title="Server response failed validation checks for expected data in SNTP packet.">SntpInvalidResponse</a> if the server response fails sanity checks expected in an SNTP response packet.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a379667af0482f651b5630fcc149d9952" title="A timeout has occurred in receiving server response with the Sntp_ReceiveTimeResponse API.">SntpErrorResponseTimeout</a> if a timeout has occurred in receiving response from the server.</li>
<li><a class="el" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798ac03ea3068c8293cf7eea8468d8c12324" title="Server sent a Kiss-o&#39;-Death message to reject the request for time. This status can be returned by th...">SntpRejectedResponse</a> if the server responded with a rejection for the time request. </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a636a84baa528354ea6115e6af2c46eed" name="a636a84baa528354ea6115e6af2c46eed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a636a84baa528354ea6115e6af2c46eed">&#9670;&nbsp;</a></span>Sntp_StatusToStr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * Sntp_StatusToStr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a>&#160;</td>
          <td class="paramname"><em>status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts <a class="el" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> to its equivalent string. </p>
<dl class="section note"><dt>Note</dt><dd>The returned string MUST NOT be modified.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">status</td><td>The status to convert to a string.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The string representation of the status code. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_b2f33c71d4aa5e7af42a1ca61ff5af1b.html">source</a></li><li class="navelem"><a class="el" href="core__sntp__client_8c.html">core_sntp_client.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>coreSNTP: Example application of using coreSNTP APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">coreSNTP<span id="projectnumber">&#160;v1.1.0</span>
   </div>
   <div id="projectbrief">Client library for synchronizing device time with internet time using Simple Network Time Protocol (SNTP)</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('code_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Example application of using coreSNTP APIs </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Example application of setting up an SNTP client with coreSNTP Library on POSIX platforms.</p>
<p >This code ONLY showcases how coreSNTP library APIs can be used. For best practices on running an SNTP client, refer to the <a href="https://github.com/FreeRTOS/FreeRTOS/tree/main/FreeRTOS-Plus/Demo/coreSNTP_Windows_Simulator">FreeRTOS Demo on GitHub</a>.<br  />
 </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;netdb.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;arpa/inet.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;poll.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="core__sntp__client_8h.html">core_sntp_client.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* @[code_example_sntpdnsresolve] */</span></div>
<div class="line"><span class="comment">/* Example POSIX implementation of SntpDnsReolve_t interface. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> resolveDns( <span class="keyword">const</span> <a class="code hl_struct" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> * pServerAddr,</div>
<div class="line">                        uint32_t * pIpV4Addr )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> status = <span class="keyword">false</span>;</div>
<div class="line">    int32_t dnsStatus = -1;</div>
<div class="line">    <span class="keyword">struct </span>addrinfo hints;</div>
<div class="line">    <span class="keyword">struct </span>addrinfo * pListHead = NULL;</div>
<div class="line"> </div>
<div class="line">    hints.ai_family = AF_UNSPEC;</div>
<div class="line"> </div>
<div class="line">    hints.ai_socktype = ( int32_t ) SOCK_STREAM;</div>
<div class="line">    hints.ai_protocol = IPPROTO_TCP;</div>
<div class="line"> </div>
<div class="line">    dnsStatus = getaddrinfo( pServerAddr-&gt;<a class="code hl_variable" href="struct_sntp_server_info__t.html#a3ac6b772408c867c83bc278aebbfe192">pServerName</a>, NULL, &amp;hints, &amp;pListHead );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( dnsStatus == 0 )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>sockaddr_in * pAddrInfo = ( <span class="keyword">struct </span>sockaddr_in * ) pListHead-&gt;ai_addr;</div>
<div class="line">        inet_ntop( pAddrInfo-&gt;sin_family,</div>
<div class="line">                   &amp;pAddrInfo-&gt;sin_addr,</div>
<div class="line">                   ( int8_t * ) pIpV4Addr,</div>
<div class="line">                   INET_ADDRSTRLEN );</div>
<div class="line"> </div>
<div class="line">        status = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    freeaddrinfo( pListHead );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"><span class="comment">/* @[code_example_sntpdnsresolve] */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* @[code_example_networkcontext] */</span></div>
<div class="line"><span class="comment">/* Example definition of NetworkContext_t for UDP socket operations. */</span></div>
<div class="line"><span class="keyword">struct </span>NetworkContext</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> udpSocket;</div>
<div class="line">};</div>
<div class="line"><span class="comment">/* @[code_example_networkcontext] */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* @[code_example_udptransport_sendto] */</span></div>
<div class="line"><span class="comment">/* Example POSIX implementation of the UdpTransportSendTo_t function of UDP transport interface. */</span></div>
<div class="line"><span class="keyword">static</span> int32_t UdpTransport_Send( <a class="code hl_typedef" href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a> * pNetworkContext,</div>
<div class="line">                                  uint32_t serverAddr,</div>
<div class="line">                                  uint16_t serverPort,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">void</span> * pBuffer,</div>
<div class="line">                                  uint16_t bytesToSend )</div>
<div class="line">{</div>
<div class="line">    int32_t bytesSent = -1, pollStatus = 1;</div>
<div class="line">    <span class="keyword">struct </span>pollfd pollFds;</div>
<div class="line"> </div>
<div class="line">    pollFds.events = POLLOUT | POLLPRI;</div>
<div class="line">    pollFds.revents = 0;</div>
<div class="line">    pollFds.fd = pNetworkContext-&gt;udpSocket;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check if there is data to read from the socket. */</span></div>
<div class="line">    pollStatus = poll( &amp;pollFds, 1, 0 );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( pollStatus &gt; 0 )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>sockaddr_in addrInfo;</div>
<div class="line">        addrInfo.sin_family = AF_INET;</div>
<div class="line">        addrInfo.sin_port = htons( serverPort );</div>
<div class="line">        addrInfo.sin_addr.s_addr = htonl( serverAddr );</div>
<div class="line"> </div>
<div class="line">        bytesSent = sendto( pNetworkContext-&gt;udpSocket,</div>
<div class="line">                            pBuffer,</div>
<div class="line">                            bytesToSend, 0,</div>
<div class="line">                            ( <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr * ) &amp;addrInfo,</div>
<div class="line">                            <span class="keyword">sizeof</span>( addrInfo ) );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pollStatus == 0 )</div>
<div class="line">    {</div>
<div class="line">        bytesSent = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bytesSent;</div>
<div class="line">}</div>
<div class="line"><span class="comment">/* @[code_example_udptransport_sendto] */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* @[code_example_udptransport_recvfrom] */</span></div>
<div class="line"><span class="comment">/* Example POSIX implementation of the UdpTransportRecvFrom_t function of UDP transport interface. */</span></div>
<div class="line"><span class="keyword">static</span> int32_t UdpTransport_Recv( <a class="code hl_typedef" href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a> * pNetworkContext,</div>
<div class="line">                                  uint32_t serverAddr,</div>
<div class="line">                                  uint16_t serverPort,</div>
<div class="line">                                  <span class="keywordtype">void</span> * pBuffer,</div>
<div class="line">                                  uint16_t bytesToRecv )</div>
<div class="line">{</div>
<div class="line">    int32_t bytesReceived = -1, pollStatus = 1;</div>
<div class="line">    <span class="keyword">struct </span>pollfd pollFds;</div>
<div class="line"> </div>
<div class="line">    pollFds.events = POLLIN | POLLPRI;</div>
<div class="line">    pollFds.revents = 0;</div>
<div class="line">    pollFds.fd = pNetworkContext-&gt;udpSocket;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check if there is data to read from the socket. */</span></div>
<div class="line">    pollStatus = poll( &amp;pollFds, 1, 0 );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( pollStatus &gt; 0 )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>sockaddr_in addrInfo;</div>
<div class="line">        addrInfo.sin_family = AF_INET;</div>
<div class="line">        addrInfo.sin_port = htons( serverPort );</div>
<div class="line">        addrInfo.sin_addr.s_addr = htonl( serverAddr );</div>
<div class="line">        socklen_t addrLen = <span class="keyword">sizeof</span>( addrInfo );</div>
<div class="line"> </div>
<div class="line">        bytesReceived = recvfrom( pNetworkContext-&gt;udpSocket, pBuffer,</div>
<div class="line">                                  bytesToRecv, 0,</div>
<div class="line">                                  ( <span class="keyword">struct</span> sockaddr * ) &amp;addrInfo,</div>
<div class="line">                                  &amp;addrLen );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pollStatus == 0 )</div>
<div class="line">    {</div>
<div class="line">        bytesReceived = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bytesReceived;</div>
<div class="line">}</div>
<div class="line"><span class="comment">/* @[code_example_udptransport_recvfrom] */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* @[code_example_sntpsettime] */</span></div>
<div class="line"><span class="comment">/* Example implementation of the SntpSetTime_t interface for POSIX platforms. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sntpClient_SetTime( <span class="keyword">const</span> <a class="code hl_struct" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> * pTimeServer,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code hl_struct" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> * pServerTime,</div>
<div class="line">                                int64_t clockOffsetMs,</div>
<div class="line">                                <a class="code hl_enumeration" href="group__sntp__enum__types.html#ga69e2cb17ab4e253491602ccfe48b141f">SntpLeapSecondInfo_t</a> leapSecondInfo )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* @[code_example_sntp_converttounixtime] */</span></div>
<div class="line">    uint32_t unixSecs;</div>
<div class="line">    uint32_t unixMs;</div>
<div class="line">    <a class="code hl_enumeration" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> status = <a class="code hl_function" href="core__sntp__serializer_8c.html#ae2e96d3bc60bb30db3107a2bc1d69121">Sntp_ConvertToUnixTime</a>( pServerTime, &amp;unixSecs, &amp;unixMs );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* @[code_example_sntp_converttounixtime] */</span></div>
<div class="line">    assert( status == <a class="code hl_enumvalue" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a> );</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>timespec serverTime =</div>
<div class="line">    {</div>
<div class="line">        .tv_sec  = unixSecs,</div>
<div class="line">        .tv_nsec = unixMs * 1000</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    clock_settime( CLOCK_REALTIME, &amp;serverTime );</div>
<div class="line">}</div>
<div class="line"><span class="comment">/* @[code_example_sntpsettime] */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* @[code_example_sntpgettime] */</span></div>
<div class="line"><span class="comment">/* Example implementation of the SntpGetTime_t interface for POSIX platforms. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sntpClient_GetTime( <a class="code hl_struct" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> * pCurrentTime )</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>timespec currTime;</div>
<div class="line"> </div>
<div class="line">    ( void ) clock_gettime( CLOCK_REALTIME, &amp;currTime );</div>
<div class="line"> </div>
<div class="line">    pCurrentTime-&gt;<a class="code hl_variable" href="struct_sntp_timestamp__t.html#a747c002d1a619beef24932a2703a579c">seconds</a> = currTime.tv_sec;</div>
<div class="line">    pCurrentTime-&gt;<a class="code hl_variable" href="struct_sntp_timestamp__t.html#a31fd5b20451f4c23534322b4eaa8d29f">fractions</a> = ( currTime.tv_sec / 1000 ) * <a class="code hl_define" href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">SNTP_FRACTION_VALUE_PER_MICROSECOND</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment">/* @[code_example_sntpgettime] */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Configuration constants for the example SNTP client. */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Following Time Servers are used for illustrating the usage of library API.</span></div>
<div class="line"><span class="comment"> * The library can be configured to use ANY time server, whether publicly available</span></div>
<div class="line"><span class="comment"> * time service like NTP Pool or a privately owned NTP server. */</span></div>
<div class="line"><span class="preprocessor">#define TEST_TIME_SERVER_1                      &quot;0.pool.ntp.org&quot;</span></div>
<div class="line"><span class="preprocessor">#define TEST_TIME_SERVER_2                      &quot;1.pool.ntp.org&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SERVER_RESPONSE_TIMEOUT_MS              3000</span></div>
<div class="line"><span class="preprocessor">#define TIME_REQUEST_SEND_WAIT_TIME_MS          2000</span></div>
<div class="line"><span class="preprocessor">#define TIME_REQUEST_RECEIVE_WAIT_TIME_MS       1000</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SYSTEM_CLOCK_FREQUENCY_TOLERANCE_PPM    500</span></div>
<div class="line"><span class="preprocessor">#define SYSTEM_CLOCK_DESIRED_ACCURACY_MS        300</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* @[code_example_sntp_init] */</span></div>
<div class="line">    <span class="comment">/* Memory for network buffer. */</span></div>
<div class="line">    uint8_t networkBuffer[ <a class="code hl_define" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b">SNTP_PACKET_BASE_SIZE</a> ];</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Create UDP socket. */</span></div>
<div class="line">    <a class="code hl_typedef" href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a> udpContext;</div>
<div class="line"> </div>
<div class="line">    udpContext.udpSocket = socket( AF_INET, SOCK_DGRAM, 0 );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Setup list of time servers. */</span></div>
<div class="line">    <a class="code hl_struct" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> pTimeServers[] =</div>
<div class="line">    {</div>
<div class="line">        {</div>
<div class="line">            .<a class="code hl_variable" href="struct_sntp_server_info__t.html#a2c89b20c6fa40631a1d70000a39a3df5">port</a> = <a class="code hl_define" href="group__sntp__constants.html#ga6664b646f80b100c83825f159d0e5bd2">SNTP_DEFAULT_SERVER_PORT</a>,</div>
<div class="line">            .pServerName = TEST_TIME_SERVER_1,</div>
<div class="line">            .serverNameLen = strlen( TEST_TIME_SERVER_1 )</div>
<div class="line">        },</div>
<div class="line">        {</div>
<div class="line">            .port = <a class="code hl_define" href="group__sntp__constants.html#ga6664b646f80b100c83825f159d0e5bd2">SNTP_DEFAULT_SERVER_PORT</a>,</div>
<div class="line">            .pServerName = TEST_TIME_SERVER_2,</div>
<div class="line">            .serverNameLen = strlen( TEST_TIME_SERVER_2 )</div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set the UDP transport interface object. */</span></div>
<div class="line">    <a class="code hl_struct" href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a> udpTransportIntf;</div>
<div class="line"> </div>
<div class="line">    udpTransportIntf.<a class="code hl_variable" href="struct_udp_transport_interface__t.html#ad47cd85071e0815a75f749710096190e">pUserContext</a> = &amp;udpContext;</div>
<div class="line">    udpTransportIntf.<a class="code hl_variable" href="struct_udp_transport_interface__t.html#a332883a73a30ab9fb229ff24f305f0b5">sendTo</a> = UdpTransport_Send;</div>
<div class="line">    udpTransportIntf.<a class="code hl_variable" href="struct_udp_transport_interface__t.html#a30f8e36e611f4d510d4ffa20b19d3cb4">recvFrom</a> = UdpTransport_Recv;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Context variable. */</span></div>
<div class="line">    <a class="code hl_struct" href="struct_sntp_context__t.html">SntpContext_t</a> context;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Initialize context. */</span></div>
<div class="line">    <a class="code hl_enumeration" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> status = <a class="code hl_function" href="core__sntp__client_8c.html#ae7f3fa647cd74f09878af88e430707fc">Sntp_Init</a>( &amp;context,</div>
<div class="line">                                     pTimeServers,</div>
<div class="line">                                     <span class="keyword">sizeof</span>( pTimeServers ) / <span class="keyword">sizeof</span>( <a class="code hl_struct" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> ),</div>
<div class="line">                                     SERVER_RESPONSE_TIMEOUT_MS,</div>
<div class="line">                                     networkBuffer,</div>
<div class="line">                                     <a class="code hl_define" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b">SNTP_PACKET_BASE_SIZE</a>,</div>
<div class="line">                                     resolveDns,</div>
<div class="line">                                     sntpClient_GetTime,</div>
<div class="line">                                     sntpClient_SetTime,</div>
<div class="line">                                     &amp;udpTransportIntf,</div>
<div class="line">                                     NULL );</div>
<div class="line"> </div>
<div class="line">    assert( status == <a class="code hl_enumvalue" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a> );</div>
<div class="line">    <span class="comment">/* @[code_example_sntp_init] */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Calculate the polling interval period for the SNTP client. */</span></div>
<div class="line">    <span class="comment">/* @[code_example_sntp_calculatepollinterval] */</span></div>
<div class="line">    uint32_t pollingIntervalPeriod;</div>
<div class="line"> </div>
<div class="line">    status = <a class="code hl_function" href="core__sntp__serializer_8c.html#a48dc19a11eb31d6077a2ca8964a1c6a9">Sntp_CalculatePollInterval</a>( SYSTEM_CLOCK_FREQUENCY_TOLERANCE_PPM,</div>
<div class="line">                                         SYSTEM_CLOCK_DESIRED_ACCURACY_MS,</div>
<div class="line">                                         &amp;pollingIntervalPeriod );</div>
<div class="line">    <span class="comment">/* @[code_example_sntp_calculatepollinterval] */</span></div>
<div class="line">    assert( status == <a class="code hl_enumvalue" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a> );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Loop of SNTP client for period time synchronization. */</span></div>
<div class="line">    <span class="comment">/* @[code_example_sntp_send_receive] */</span></div>
<div class="line">    <span class="keywordflow">while</span>( 1 )</div>
<div class="line">    {</div>
<div class="line">        status = <a class="code hl_function" href="core__sntp__client_8c.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a>( &amp;context,</div>
<div class="line">                                       rand() % UINT32_MAX,</div>
<div class="line">                                       TIME_REQUEST_SEND_WAIT_TIME_MS );</div>
<div class="line">        assert( status == <a class="code hl_enumvalue" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a> );</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">do</span></div>
<div class="line">        {</div>
<div class="line">            status = <a class="code hl_function" href="core__sntp__client_8c.html#ab077d90d19e70a33ab08b31f48728ba5">Sntp_ReceiveTimeResponse</a>( &amp;context, TIME_REQUEST_RECEIVE_WAIT_TIME_MS );</div>
<div class="line">        } <span class="keywordflow">while</span>( status == <a class="code hl_enumvalue" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a473ea25a626b0ab1067a9887e49d113e">SntpNoResponseReceived</a> );</div>
<div class="line"> </div>
<div class="line">        assert( status == <a class="code hl_enumvalue" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a> );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* Delay of poll interval period before next time synchronization. */</span></div>
<div class="line">        sleep( pollingIntervalPeriod );</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* @[code_example_sntp_send_receive] */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="acore__sntp__client_8c_html_ab077d90d19e70a33ab08b31f48728ba5"><div class="ttname"><a href="core__sntp__client_8c.html#ab077d90d19e70a33ab08b31f48728ba5">Sntp_ReceiveTimeResponse</a></div><div class="ttdeci">SntpStatus_t Sntp_ReceiveTimeResponse(SntpContext_t *pContext, uint32_t blockTimeMs)</div><div class="ttdoc">Receives a time response from the server that has been requested for time with the Sntp_SendTimeReque...</div><div class="ttdef"><b>Definition:</b> core_sntp_client.c:815</div></div>
<div class="ttc" id="acore__sntp__client_8c_html_ae6cb1fe85cff973b2cfa73751adb4062"><div class="ttname"><a href="core__sntp__client_8c.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a></div><div class="ttdeci">SntpStatus_t Sntp_SendTimeRequest(SntpContext_t *pContext, uint32_t randomNumber, uint32_t blockTimeMs)</div><div class="ttdoc">Sends a request for time from the currently configured server (in the context). If the user has provi...</div><div class="ttdef"><b>Definition:</b> core_sntp_client.c:427</div></div>
<div class="ttc" id="acore__sntp__client_8c_html_ae7f3fa647cd74f09878af88e430707fc"><div class="ttname"><a href="core__sntp__client_8c.html#ae7f3fa647cd74f09878af88e430707fc">Sntp_Init</a></div><div class="ttdeci">SntpStatus_t Sntp_Init(SntpContext_t *pContext, const SntpServerInfo_t *pTimeServers, size_t numOfServers, uint32_t serverResponseTimeoutMs, uint8_t *pNetworkBuffer, size_t bufferSize, SntpResolveDns_t resolveDnsFunc, SntpGetTime_t getSystemTimeFunc, SntpSetTime_t setSystemTimeFunc, const UdpTransportInterface_t *pTransportIntf, const SntpAuthenticationInterface_t *pAuthIntf)</div><div class="ttdoc">Initializes a context for SNTP client communication with SNTP/NTP servers.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.c:43</div></div>
<div class="ttc" id="acore__sntp__client_8h_html"><div class="ttname"><a href="core__sntp__client_8h.html">core_sntp_client.h</a></div><div class="ttdoc">API of an SNTPv4 client library that can send time requests and receive time response to/from SNTP/NT...</div></div>
<div class="ttc" id="acore__sntp__serializer_8c_html_a48dc19a11eb31d6077a2ca8964a1c6a9"><div class="ttname"><a href="core__sntp__serializer_8c.html#a48dc19a11eb31d6077a2ca8964a1c6a9">Sntp_CalculatePollInterval</a></div><div class="ttdeci">SntpStatus_t Sntp_CalculatePollInterval(uint16_t clockFreqTolerance, uint16_t desiredAccuracy, uint32_t *pPollInterval)</div><div class="ttdoc">Utility to calculate the poll interval of sending periodic time queries to servers to achieve a desir...</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.c:738</div></div>
<div class="ttc" id="acore__sntp__serializer_8c_html_ae2e96d3bc60bb30db3107a2bc1d69121"><div class="ttname"><a href="core__sntp__serializer_8c.html#ae2e96d3bc60bb30db3107a2bc1d69121">Sntp_ConvertToUnixTime</a></div><div class="ttdeci">SntpStatus_t Sntp_ConvertToUnixTime(const SntpTimestamp_t *pSntpTime, uint32_t *pUnixTimeSecs, uint32_t *pUnixTimeMicrosecs)</div><div class="ttdoc">Utility to convert SNTP timestamp (that uses 1st Jan 1900 as the epoch) to UNIX timestamp (that uses ...</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.c:802</div></div>
<div class="ttc" id="agroup__sntp__constants_html_ga1baca7c2b918d398acbc5f9412c01ebd"><div class="ttname"><a href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">SNTP_FRACTION_VALUE_PER_MICROSECOND</a></div><div class="ttdeci">#define SNTP_FRACTION_VALUE_PER_MICROSECOND</div><div class="ttdoc">Number of SNTP timestamp fractions in 1 microsecond.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:66</div></div>
<div class="ttc" id="agroup__sntp__constants_html_ga6664b646f80b100c83825f159d0e5bd2"><div class="ttname"><a href="group__sntp__constants.html#ga6664b646f80b100c83825f159d0e5bd2">SNTP_DEFAULT_SERVER_PORT</a></div><div class="ttdeci">#define SNTP_DEFAULT_SERVER_PORT</div><div class="ttdoc">The default UDP port supported by SNTP/NTP servers for client-server communication.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:71</div></div>
<div class="ttc" id="agroup__sntp__constants_html_ga9fb0febdb6e2f2dff2e133ef49ce205b"><div class="ttname"><a href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b">SNTP_PACKET_BASE_SIZE</a></div><div class="ttdeci">#define SNTP_PACKET_BASE_SIZE</div><div class="ttdoc">The base packet size of request and response of the (S)NTP protocol.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:52</div></div>
<div class="ttc" id="agroup__sntp__enum__types_html_ga69e2cb17ab4e253491602ccfe48b141f"><div class="ttname"><a href="group__sntp__enum__types.html#ga69e2cb17ab4e253491602ccfe48b141f">SntpLeapSecondInfo_t</a></div><div class="ttdeci">SntpLeapSecondInfo_t</div><div class="ttdoc">Enumeration for leap second information that an SNTP server can send its response to a time request....</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:263</div></div>
<div class="ttc" id="agroup__sntp__enum__types_html_gaef7b22d8008bbfbbc7bbea5a7a30e798"><div class="ttname"><a href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a></div><div class="ttdeci">SntpStatus_t</div><div class="ttdoc">Enumeration of status codes that can be returned by the coreSNTP Library API.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:138</div></div>
<div class="ttc" id="agroup__sntp__enum__types_html_ggaef7b22d8008bbfbbc7bbea5a7a30e798a473ea25a626b0ab1067a9887e49d113e"><div class="ttname"><a href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a473ea25a626b0ab1067a9887e49d113e">SntpNoResponseReceived</a></div><div class="ttdeci">@ SntpNoResponseReceived</div><div class="ttdoc">No SNTP packet for server response is received from the network by the Sntp_ReceiveTimeResponse API.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:240</div></div>
<div class="ttc" id="agroup__sntp__enum__types_html_ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016"><div class="ttname"><a href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a></div><div class="ttdeci">@ SntpSuccess</div><div class="ttdoc">Successful operation of an SNTP API.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:142</div></div>
<div class="ttc" id="agroup__sntp__struct__types_html_ga7769e434e7811caed8cd6fd7f9ec26ec"><div class="ttname"><a href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a></div><div class="ttdeci">struct NetworkContext NetworkContext_t</div><div class="ttdoc">A user-defined type for context that is passed to the transport interface functions....</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:161</div></div>
<div class="ttc" id="astruct_sntp_context__t_html"><div class="ttname"><a href="struct_sntp_context__t.html">SntpContext_t</a></div><div class="ttdoc">Structure for a context that stores state for managing a long-running SNTP client that periodically p...</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:382</div></div>
<div class="ttc" id="astruct_sntp_server_info__t_html"><div class="ttname"><a href="struct_sntp_server_info__t.html">SntpServerInfo_t</a></div><div class="ttdoc">Structure representing information for a time server.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:78</div></div>
<div class="ttc" id="astruct_sntp_server_info__t_html_a2c89b20c6fa40631a1d70000a39a3df5"><div class="ttname"><a href="struct_sntp_server_info__t.html#a2c89b20c6fa40631a1d70000a39a3df5">SntpServerInfo_t::port</a></div><div class="ttdeci">uint16_t port</div><div class="ttdoc">The UDP port supported by the server for SNTP/NTP communication.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:81</div></div>
<div class="ttc" id="astruct_sntp_server_info__t_html_a3ac6b772408c867c83bc278aebbfe192"><div class="ttname"><a href="struct_sntp_server_info__t.html#a3ac6b772408c867c83bc278aebbfe192">SntpServerInfo_t::pServerName</a></div><div class="ttdeci">const char * pServerName</div><div class="ttdoc">The time server name.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:79</div></div>
<div class="ttc" id="astruct_sntp_timestamp__t_html"><div class="ttname"><a href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a></div><div class="ttdoc">Structure representing an SNTP timestamp.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:282</div></div>
<div class="ttc" id="astruct_sntp_timestamp__t_html_a31fd5b20451f4c23534322b4eaa8d29f"><div class="ttname"><a href="struct_sntp_timestamp__t.html#a31fd5b20451f4c23534322b4eaa8d29f">SntpTimestamp_t::fractions</a></div><div class="ttdeci">uint32_t fractions</div><div class="ttdoc">The fractions part of the SNTP timestamp with resolution of 2^(-32) ~ 232 picoseconds.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:284</div></div>
<div class="ttc" id="astruct_sntp_timestamp__t_html_a747c002d1a619beef24932a2703a579c"><div class="ttname"><a href="struct_sntp_timestamp__t.html#a747c002d1a619beef24932a2703a579c">SntpTimestamp_t::seconds</a></div><div class="ttdeci">uint32_t seconds</div><div class="ttdoc">Number of seconds since epoch time.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:283</div></div>
<div class="ttc" id="astruct_udp_transport_interface__t_html"><div class="ttname"><a href="struct_udp_transport_interface__t.html">UdpTransportInterface_t</a></div><div class="ttdoc">Struct representing the UDP transport interface for user-defined functions that coreSNTP library depe...</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:246</div></div>
<div class="ttc" id="astruct_udp_transport_interface__t_html_a30f8e36e611f4d510d4ffa20b19d3cb4"><div class="ttname"><a href="struct_udp_transport_interface__t.html#a30f8e36e611f4d510d4ffa20b19d3cb4">UdpTransportInterface_t::recvFrom</a></div><div class="ttdeci">UdpTransportRecvFrom_t recvFrom</div><div class="ttdoc">The user-defined UDP receive function.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:250</div></div>
<div class="ttc" id="astruct_udp_transport_interface__t_html_a332883a73a30ab9fb229ff24f305f0b5"><div class="ttname"><a href="struct_udp_transport_interface__t.html#a332883a73a30ab9fb229ff24f305f0b5">UdpTransportInterface_t::sendTo</a></div><div class="ttdeci">UdpTransportSendTo_t sendTo</div><div class="ttdoc">The user-defined UDP send function.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:249</div></div>
<div class="ttc" id="astruct_udp_transport_interface__t_html_ad47cd85071e0815a75f749710096190e"><div class="ttname"><a href="struct_udp_transport_interface__t.html#ad47cd85071e0815a75f749710096190e">UdpTransportInterface_t::pUserContext</a></div><div class="ttdeci">NetworkContext_t * pUserContext</div><div class="ttdoc">The user-defined context for storing network socket information.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:247</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>

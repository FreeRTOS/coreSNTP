<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>coreSNTP: Porting Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">coreSNTP<span id="projectnumber">&#160;v1.1.1</span>
   </div>
   <div id="projectbrief">Client library for synchronizing device time with internet time using Simple Network Time Protocol (SNTP)</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('sntp_porting.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Porting Guide </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Guide for porting coreSNTP library to a new platform.</p>
<p >A port of coreSNTP library for a new platform must provide the following components:</p><ol type="1">
<li><a class="el" href="sntp_porting.html#sntp_porting_config">Logging Configuration Macros</a></li>
<li><a class="el" href="sntp_porting.html#sntp_porting_dnsresolve">DNS Resolve Function</a></li>
<li><a class="el" href="sntp_porting.html#sntp_porting_transport">UDP Transport Interface</a></li>
<li><a class="el" href="sntp_porting.html#sntp_porting_gettime">Get Time Function</a></li>
<li><a class="el" href="sntp_porting.html#sntp_porting_settime">Set Time Function</a></li>
<li><a class="el" href="sntp_porting.html#sntp_porting_authentication">Authentication Interface</a></li>
</ol>
<h1><a class="anchor" id="sntp_porting_config"></a>
Configuration Macros for Logging</h1>
<p >Macros for enabling logging that can be defined through the config header <code>core_sntp_config.h</code>, or passed in as compiler options.</p>
<dl class="section note"><dt>Note</dt><dd>If a custom configuration header <code>core_sntp_config.h</code> is not provided, then the <a class="el" href="core_sntp_config.html#SNTP_DO_NOT_USE_CUSTOM_CONFIG">SNTP_DO_NOT_USE_CUSTOM_CONFIG</a> macro must be defined.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="core_sntp_config.html">Configurations</a></dd></dl>
<p>The following logging macros are used throughout the library:</p><ul>
<li><a class="el" href="core__sntp__config__defaults_8h.html#a8d9dbaaa88129137a4c68ba0456a18b1">LogError</a></li>
<li><a class="el" href="core__sntp__config__defaults_8h.html#a7da92048aaf0cbfcacde9539c98a0e05">LogWarn</a></li>
<li><a class="el" href="core__sntp__config__defaults_8h.html#a00810b1cb9d2f25d25ce2d4d93815fba">LogInfo</a></li>
<li><a class="el" href="core__sntp__config__defaults_8h.html#af60e8ffc327d136e5d0d8441ed98c98d">LogDebug</a></li>
</ul>
<p >Here is an example implementation of logging macros for POSIX platforms </p><div class="fragment"><div class="line"><span class="comment">/************* Define Logging Macros using printf function ***********/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define PrintfError( ... )         printf( &quot;Error: &quot;</span>__VA_ARGS__ );  printf( &quot;\n&quot; )</div>
<div class="line"><span class="preprocessor">#define PrintfWarn( ... )          printf( &quot;Warn: &quot;</span>__VA_ARGS__ );  printf( &quot;\n&quot; )</div>
<div class="line"><span class="preprocessor">#define PrintfInfo( ... )          printf( &quot;Info: &quot;</span> __VA_ARGS__ ); printf( &quot;\n&quot; )</div>
<div class="line"><span class="preprocessor">#define PrintfDebug( ... )         printf( &quot;Debug: &quot;</span> __VA_ARGS__ ); printf( &quot;\n&quot; )</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef LOGGING_LEVEL_ERROR</span></div>
<div class="line"><span class="preprocessor">    #define LogError( message )    PrintfError message</span></div>
<div class="line"><span class="preprocessor">#elif defined( LOGGING_LEVEL_WARNING )</span></div>
<div class="line"><span class="preprocessor">    #define LogError( message )    PrintfError message</span></div>
<div class="line"><span class="preprocessor">    #define LogWarn( message )     PrintfWarn message</span></div>
<div class="line"><span class="preprocessor">#elif defined( LOGGING_LEVEL_INFO )</span></div>
<div class="line"><span class="preprocessor">    #define LogError( message )    PrintfError message</span></div>
<div class="line"><span class="preprocessor">    #define LogWarn( message )     PrintfWarn message</span></div>
<div class="line"><span class="preprocessor">    #define LogInfo( message )     PrintfInfo message</span></div>
<div class="line"><span class="preprocessor">#elif defined( LOGGING_LEVEL_DEBUG )</span></div>
<div class="line"><span class="preprocessor">    #define LogError( message )    PrintfError message</span></div>
<div class="line"><span class="preprocessor">    #define LogWarn( message )     PrintfWarn message</span></div>
<div class="line"><span class="preprocessor">    #define LogInfo( message )     PrintfInfo message</span></div>
<div class="line"><span class="preprocessor">    #define LogDebug( message )    PrintfDebug message</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* ifdef LOGGING_LEVEL_ERROR */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/**************************************************/</span></div>
</div><!-- fragment --><h1><a class="anchor" id="sntp_porting_dnsresolve"></a>
DNS Resolve Function</h1>
<p >The coreSNTP library requires a DNS Resolve interface that must be implemented to obtain the latest IPv4 address information of a time server before sending it a time request.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__sntp__callback__types.html#gaef268b4cc2cf00e3e573b637cde7c09e">DNS Resolve Function</a></dd></dl>
<dl class="section note"><dt>Note</dt><dd>The coreSNTP library will re-resolve the DNS name of a time server on each attempt of requesting time from it. For efficiency of DNS resolution operations, your implementation can utilize DNS caching of resolved domains if your platform supports it.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/* Example POSIX implementation of SntpDnsReolve_t interface. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">bool</span> resolveDns( <span class="keyword">const</span> <a class="code hl_struct" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> * pServerAddr,</div>
<div class="line">                        uint32_t * pIpV4Addr )</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> status = <span class="keyword">false</span>;</div>
<div class="line">    int32_t dnsStatus = -1;</div>
<div class="line">    <span class="keyword">struct </span>addrinfo hints;</div>
<div class="line">    <span class="keyword">struct </span>addrinfo * pListHead = NULL;</div>
<div class="line"> </div>
<div class="line">    hints.ai_family = AF_UNSPEC;</div>
<div class="line"> </div>
<div class="line">    hints.ai_socktype = ( int32_t ) SOCK_STREAM;</div>
<div class="line">    hints.ai_protocol = IPPROTO_TCP;</div>
<div class="line"> </div>
<div class="line">    dnsStatus = getaddrinfo( pServerAddr-&gt;<a class="code hl_variable" href="struct_sntp_server_info__t.html#a3ac6b772408c867c83bc278aebbfe192">pServerName</a>, NULL, &amp;hints, &amp;pListHead );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( dnsStatus == 0 )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>sockaddr_in * pAddrInfo = ( <span class="keyword">struct </span>sockaddr_in * ) pListHead-&gt;ai_addr;</div>
<div class="line">        inet_ntop( pAddrInfo-&gt;sin_family,</div>
<div class="line">                   &amp;pAddrInfo-&gt;sin_addr,</div>
<div class="line">                   ( int8_t * ) pIpV4Addr,</div>
<div class="line">                   INET_ADDRSTRLEN );</div>
<div class="line"> </div>
<div class="line">        status = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    freeaddrinfo( pListHead );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="ttc" id="astruct_sntp_server_info__t_html"><div class="ttname"><a href="struct_sntp_server_info__t.html">SntpServerInfo_t</a></div><div class="ttdoc">Structure representing information for a time server.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:66</div></div>
<div class="ttc" id="astruct_sntp_server_info__t_html_a3ac6b772408c867c83bc278aebbfe192"><div class="ttname"><a href="struct_sntp_server_info__t.html#a3ac6b772408c867c83bc278aebbfe192">SntpServerInfo_t::pServerName</a></div><div class="ttdeci">const char * pServerName</div><div class="ttdoc">The time server name.</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:67</div></div>
</div><!-- fragment --><h1><a class="anchor" id="sntp_porting_transport"></a>
UDP Transport Interface</h1>
<p >The coreSNTP library requires a UDP transport interface that must be implemented in order to send and receive SNTP packets over the network.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="struct_udp_transport_interface__t.html">UDP Transport Interface</a></dd></dl>
<dl class="section note"><dt>Note</dt><dd>For security against unwanted server response packets, it is RECOMMENDED that the UDP socket that is used for implementing the UDP transport interface functions of performing network I/O is kept open ONLY during duration of an SNTP request-response iteration as opposed to keeping it always open across iterations. One way to achieve this is to open a new UDP socket before calling <a class="el" href="core__sntp__client_8h.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a> API and close it after receiving server response (or timeout) with the <a class="el" href="core__sntp__client_8h.html#ab077d90d19e70a33ab08b31f48728ba5">Sntp_ReceiveTimeResponse</a> API.</dd></dl>
<p>A port must implement functions corresponding to the following functions pointers:</p><ul>
<li><a class="el" href="group__sntp__callback__types.html#gaadd728af5c040252f0b7224e72ea771f">UDP Transport Send</a>: A function to send bytes on the network over UDP. It is RECOMMENDED to implement this function as non-blocking so the total block time can be managed by the <a class="el" href="core__sntp__client_8h.html#ae6cb1fe85cff973b2cfa73751adb4062">Sntp_SendTimeRequest</a> API.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">/* Example POSIX implementation of the UdpTransportSendTo_t function of UDP transport interface. */</span></div>
<div class="line"><span class="keyword">static</span> int32_t UdpTransport_Send( <a class="code hl_typedef" href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a> * pNetworkContext,</div>
<div class="line">                                  uint32_t serverAddr,</div>
<div class="line">                                  uint16_t serverPort,</div>
<div class="line">                                  <span class="keyword">const</span> <span class="keywordtype">void</span> * pBuffer,</div>
<div class="line">                                  uint16_t bytesToSend )</div>
<div class="line">{</div>
<div class="line">    int32_t bytesSent = -1, pollStatus = 1;</div>
<div class="line">    <span class="keyword">struct </span>pollfd pollFds;</div>
<div class="line"> </div>
<div class="line">    pollFds.events = POLLOUT | POLLPRI;</div>
<div class="line">    pollFds.revents = 0;</div>
<div class="line">    pollFds.fd = pNetworkContext-&gt;udpSocket;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check if there is data to read from the socket. */</span></div>
<div class="line">    pollStatus = poll( &amp;pollFds, 1, 0 );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( pollStatus &gt; 0 )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>sockaddr_in addrInfo;</div>
<div class="line">        addrInfo.sin_family = AF_INET;</div>
<div class="line">        addrInfo.sin_port = htons( serverPort );</div>
<div class="line">        addrInfo.sin_addr.s_addr = htonl( serverAddr );</div>
<div class="line"> </div>
<div class="line">        bytesSent = sendto( pNetworkContext-&gt;udpSocket,</div>
<div class="line">                            pBuffer,</div>
<div class="line">                            bytesToSend, 0,</div>
<div class="line">                            ( <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr * ) &amp;addrInfo,</div>
<div class="line">                            <span class="keyword">sizeof</span>( addrInfo ) );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pollStatus == 0 )</div>
<div class="line">    {</div>
<div class="line">        bytesSent = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bytesSent;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__sntp__struct__types_html_ga7769e434e7811caed8cd6fd7f9ec26ec"><div class="ttname"><a href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a></div><div class="ttdeci">struct NetworkContext NetworkContext_t</div><div class="ttdoc">A user-defined type for context that is passed to the transport interface functions....</div><div class="ttdef"><b>Definition:</b> core_sntp_client.h:149</div></div>
</div><!-- fragment --><ul>
<li><a class="el" href="group__sntp__callback__types.html#ga138d8e928110f9b0cbc214135c91b344">UDP Transport Receive</a>: A function to receive bytes from the network over UDP. It is RECOMMENDED to implement this function as non-blocking so the total block time can be managed by the <a class="el" href="core__sntp__client_8h.html#ab077d90d19e70a33ab08b31f48728ba5">Sntp_ReceiveTimeResponse</a> API.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">/* Example POSIX implementation of the UdpTransportRecvFrom_t function of UDP transport interface. */</span></div>
<div class="line"><span class="keyword">static</span> int32_t UdpTransport_Recv( <a class="code hl_typedef" href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a> * pNetworkContext,</div>
<div class="line">                                  uint32_t serverAddr,</div>
<div class="line">                                  uint16_t serverPort,</div>
<div class="line">                                  <span class="keywordtype">void</span> * pBuffer,</div>
<div class="line">                                  uint16_t bytesToRecv )</div>
<div class="line">{</div>
<div class="line">    int32_t bytesReceived = -1, pollStatus = 1;</div>
<div class="line">    <span class="keyword">struct </span>pollfd pollFds;</div>
<div class="line"> </div>
<div class="line">    pollFds.events = POLLIN | POLLPRI;</div>
<div class="line">    pollFds.revents = 0;</div>
<div class="line">    pollFds.fd = pNetworkContext-&gt;udpSocket;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check if there is data to read from the socket. */</span></div>
<div class="line">    pollStatus = poll( &amp;pollFds, 1, 0 );</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>( pollStatus &gt; 0 )</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span>sockaddr_in addrInfo;</div>
<div class="line">        addrInfo.sin_family = AF_INET;</div>
<div class="line">        addrInfo.sin_port = htons( serverPort );</div>
<div class="line">        addrInfo.sin_addr.s_addr = htonl( serverAddr );</div>
<div class="line">        socklen_t addrLen = <span class="keyword">sizeof</span>( addrInfo );</div>
<div class="line"> </div>
<div class="line">        bytesReceived = recvfrom( pNetworkContext-&gt;udpSocket, pBuffer,</div>
<div class="line">                                  bytesToRecv, 0,</div>
<div class="line">                                  ( <span class="keyword">struct</span> sockaddr * ) &amp;addrInfo,</div>
<div class="line">                                  &amp;addrLen );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pollStatus == 0 )</div>
<div class="line">    {</div>
<div class="line">        bytesReceived = 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bytesReceived;</div>
<div class="line">}</div>
</div><!-- fragment --><p >The above two functions take in a pointer to a <a class="el" href="group__sntp__struct__types.html#ga7769e434e7811caed8cd6fd7f9ec26ec">NetworkContext_t</a>, the typename of a <code>struct NetworkContext</code>. The NetworkContext struct must also be defined by the port, and ought to contain any information necessary to send and receive data with the <a class="el" href="group__sntp__callback__types.html#gaadd728af5c040252f0b7224e72ea771f">UdpTransportSendTo_t</a> and <a class="el" href="group__sntp__callback__types.html#ga138d8e928110f9b0cbc214135c91b344">UdpTransportRecvFrom_t</a> implementations, respectively:</p>
<div class="fragment"><div class="line"><span class="comment">/* Example definition of NetworkContext_t for UDP socket operations. */</span></div>
<div class="line"><span class="keyword">struct </span>NetworkContext</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> udpSocket;</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="sntp_porting_gettime"></a>
Get Time Function</h1>
<p >The coreSNTP library uses this function to obtain time from system for tracking timeout durations as well as generating SNTP request packet.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__sntp__callback__types.html#ga1e30d57887e46bee4074a5ba62f681e8">SntpGetTime_t</a></dd></dl>
<p>If the device does not have real-world time information (on device boot-up for example), it is acceptable for this function to provide the system-time that does not match the real-world time, because once a time information is received from a time server, the system time can be corrected to match the real-world time. Refer to the next section on how to correct the system time.</p>
<div class="fragment"><div class="line"><span class="comment">/* Example implementation of the SntpGetTime_t interface for POSIX platforms. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sntpClient_GetTime( <a class="code hl_struct" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> * pCurrentTime )</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>timespec currTime;</div>
<div class="line"> </div>
<div class="line">    ( void ) clock_gettime( CLOCK_REALTIME, &amp;currTime );</div>
<div class="line"> </div>
<div class="line">    pCurrentTime-&gt;<a class="code hl_variable" href="struct_sntp_timestamp__t.html#a747c002d1a619beef24932a2703a579c">seconds</a> = currTime.tv_sec;</div>
<div class="line">    pCurrentTime-&gt;<a class="code hl_variable" href="struct_sntp_timestamp__t.html#a31fd5b20451f4c23534322b4eaa8d29f">fractions</a> = ( currTime.tv_sec / 1000 ) * <a class="code hl_define" href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">SNTP_FRACTION_VALUE_PER_MICROSECOND</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__sntp__constants_html_ga1baca7c2b918d398acbc5f9412c01ebd"><div class="ttname"><a href="group__sntp__constants.html#ga1baca7c2b918d398acbc5f9412c01ebd">SNTP_FRACTION_VALUE_PER_MICROSECOND</a></div><div class="ttdeci">#define SNTP_FRACTION_VALUE_PER_MICROSECOND</div><div class="ttdoc">Number of SNTP timestamp fractions in 1 microsecond.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:66</div></div>
<div class="ttc" id="astruct_sntp_timestamp__t_html"><div class="ttname"><a href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a></div><div class="ttdoc">Structure representing an SNTP timestamp.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:282</div></div>
<div class="ttc" id="astruct_sntp_timestamp__t_html_a31fd5b20451f4c23534322b4eaa8d29f"><div class="ttname"><a href="struct_sntp_timestamp__t.html#a31fd5b20451f4c23534322b4eaa8d29f">SntpTimestamp_t::fractions</a></div><div class="ttdeci">uint32_t fractions</div><div class="ttdoc">The fractions part of the SNTP timestamp with resolution of 2^(-32) ~ 232 picoseconds.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:284</div></div>
<div class="ttc" id="astruct_sntp_timestamp__t_html_a747c002d1a619beef24932a2703a579c"><div class="ttname"><a href="struct_sntp_timestamp__t.html#a747c002d1a619beef24932a2703a579c">SntpTimestamp_t::seconds</a></div><div class="ttdeci">uint32_t seconds</div><div class="ttdoc">Number of seconds since epoch time.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:283</div></div>
</div><!-- fragment --><h1><a class="anchor" id="sntp_porting_settime"></a>
Set Time Function</h1>
<p >The coreSNTP library calls this function to notify the device about the latest time received from a time server as well as the clock drift of the system time from the server time.</p>
<div class="fragment"><div class="line"><span class="comment">/* Example implementation of the SntpSetTime_t interface for POSIX platforms. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> sntpClient_SetTime( <span class="keyword">const</span> <a class="code hl_struct" href="struct_sntp_server_info__t.html">SntpServerInfo_t</a> * pTimeServer,</div>
<div class="line">                                <span class="keyword">const</span> <a class="code hl_struct" href="struct_sntp_timestamp__t.html">SntpTimestamp_t</a> * pServerTime,</div>
<div class="line">                                int64_t clockOffsetMs,</div>
<div class="line">                                <a class="code hl_enumeration" href="group__sntp__enum__types.html#ga69e2cb17ab4e253491602ccfe48b141f">SntpLeapSecondInfo_t</a> leapSecondInfo )</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* @[code_example_sntp_converttounixtime] */</span></div>
<div class="line">    uint32_t unixSecs;</div>
<div class="line">    uint32_t unixMs;</div>
<div class="line">    <a class="code hl_enumeration" href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a> status = <a class="code hl_function" href="core__sntp__serializer_8c.html#ae2e96d3bc60bb30db3107a2bc1d69121">Sntp_ConvertToUnixTime</a>( pServerTime, &amp;unixSecs, &amp;unixMs );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* @[code_example_sntp_converttounixtime] */</span></div>
<div class="line">    assert( status == <a class="code hl_enumvalue" href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a> );</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>timespec serverTime =</div>
<div class="line">    {</div>
<div class="line">        .tv_sec  = unixSecs,</div>
<div class="line">        .tv_nsec = unixMs * 1000</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    clock_settime( CLOCK_REALTIME, &amp;serverTime );</div>
<div class="line">}</div>
<div class="ttc" id="acore__sntp__serializer_8c_html_ae2e96d3bc60bb30db3107a2bc1d69121"><div class="ttname"><a href="core__sntp__serializer_8c.html#ae2e96d3bc60bb30db3107a2bc1d69121">Sntp_ConvertToUnixTime</a></div><div class="ttdeci">SntpStatus_t Sntp_ConvertToUnixTime(const SntpTimestamp_t *pSntpTime, uint32_t *pUnixTimeSecs, uint32_t *pUnixTimeMicrosecs)</div><div class="ttdoc">Utility to convert SNTP timestamp (that uses 1st Jan 1900 as the epoch) to UNIX timestamp (that uses ...</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.c:810</div></div>
<div class="ttc" id="agroup__sntp__enum__types_html_ga69e2cb17ab4e253491602ccfe48b141f"><div class="ttname"><a href="group__sntp__enum__types.html#ga69e2cb17ab4e253491602ccfe48b141f">SntpLeapSecondInfo_t</a></div><div class="ttdeci">SntpLeapSecondInfo_t</div><div class="ttdoc">Enumeration for leap second information that an SNTP server can send its response to a time request....</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:263</div></div>
<div class="ttc" id="agroup__sntp__enum__types_html_gaef7b22d8008bbfbbc7bbea5a7a30e798"><div class="ttname"><a href="group__sntp__enum__types.html#gaef7b22d8008bbfbbc7bbea5a7a30e798">SntpStatus_t</a></div><div class="ttdeci">SntpStatus_t</div><div class="ttdoc">Enumeration of status codes that can be returned by the coreSNTP Library API.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:138</div></div>
<div class="ttc" id="agroup__sntp__enum__types_html_ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016"><div class="ttname"><a href="group__sntp__enum__types.html#ggaef7b22d8008bbfbbc7bbea5a7a30e798a8486f9ee1815b43418a9c0478bd8f016">SntpSuccess</a></div><div class="ttdeci">@ SntpSuccess</div><div class="ttdoc">Successful operation of an SNTP API.</div><div class="ttdef"><b>Definition:</b> core_sntp_serializer.h:142</div></div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__sntp__callback__types.html#gade7b1a15684e1272ef7dbb9e4486c285">SntpSetTime_t</a></dd></dl>
<p>Platforms should implement this function to perform clock disciple operation on the system clock, that is appropriate for the clock accuracy needs of the application.</p>
<h1><a class="anchor" id="sntp_porting_authentication"></a>
Authentication Interface</h1>
<p >The coreSNTP library exposes an authentication interface to allow customer-chosen authentication mechanism to be used in SNTP communication with time server(s) for security.</p>
<dl class="section note"><dt>Note</dt><dd>It is RECOMMENDED to enable authentication in communication with your time server(s) of choice to protect against attacks that modify or spoof server responses. The SNTPv4 protocol is flexible to be used with any symmetric-key or asymmetric key cryptographic algorithm depending on the support provided by time servers of your choice. For an example of using AES-128-CMAC as the authentication algorithm, please refer to <a href="https://github.com/FreeRTOS/FreeRTOS/tree/main/FreeRTOS-Plus/Demo/coreSNTP_Windows_Simulator">coreSNTP demo in FreeRTOS/FreeRTOS repository</a>.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="struct_sntp_authentication_interface__t.html">SntpAuthenticationInterface_t</a> A port that uses authentication to communicate with time server must implement the following function pointers:<ul>
<li><a class="el" href="group__sntp__callback__types.html#ga7f01446c0d655614b99fd4043c8f032a">Add client authentication code</a>: A function to generate and append authentication data for client to be validated by the time server. The first <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b">SNTP_PACKET_BASE_SIZE</a> bytes in the buffer supplied to this function contains the SNTP request data which can be used to generate the authentication code. The generated authentication code SHOULD be written to the same buffer after the first <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b">SNTP_PACKET_BASE_SIZE</a> bytes. This function should also return the number of authentication bytes appended to the library through an output parameter, so that the library knows about the total size of the SNTP packet.</li>
<li><a class="el" href="group__sntp__callback__types.html#gae382a67b0ffbb4721d8d599efe3020c4">Validate server authentication</a>: A function to validate the authentication code in a received SNTP time response from the network to confirm that the expected server is the sender of the response and the timestamps in the packet are trustworthy to update system time. This server authentication data is usually validated by checking that the data can be regenerated by the client from the first <a class="el" href="group__sntp__constants.html#ga9fb0febdb6e2f2dff2e133ef49ce205b" title="The base packet size of request and response of the (S)NTP protocol.">SNTP_PACKET_BASE_SIZE</a> bytes of the received SNTP packet from the network.</li>
</ul>
</dd></dl>
<p>The above two functions take in a pointer to a <a class="el" href="group__sntp__struct__types.html#gaff243b342eebc2622fbb493d08663133">SntpAuthContext_t</a>, the typename of a <code>struct SntpAuthContext</code>. The <code>SntpAuthContext</code> struct must also be defined by the port, to store necessary information (like a PKCS#11 label representing credential secret) for performing cryptographic generation and validation operations in the <a class="el" href="group__sntp__callback__types.html#ga7f01446c0d655614b99fd4043c8f032a">SntpGenerateAuthCode_t</a> and <a class="el" href="group__sntp__callback__types.html#gae382a67b0ffbb4721d8d599efe3020c4">SntpValidateServerAuth_t</a> functions respectively. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
